<?xml version="1.0" encoding="utf-8" standalone="yes"?>
<rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom">
  <channel>
    <title>Posts on О технологиях и не только</title>
    <link>https://alebsys.github.io/posts/</link>
    <description>О технологиях и не только (Posts)</description>
    <generator>Hugo -- gohugo.io</generator>
    <language>en-us</language>
    <lastBuildDate>Fri, 16 Sep 2022 00:00:00 +0000</lastBuildDate>
    
    <atom:link href="https://alebsys.github.io/posts/index.xml" rel="self" type="application/rss+xml" />
    
    
    <item>
      <title>Performance kube-dns</title>
      <link>https://alebsys.github.io/posts/k8s_dns_perf_improve/</link>
      <pubDate>Fri, 16 Sep 2022 00:00:00 +0000</pubDate>
      
      <guid>https://alebsys.github.io/posts/k8s_dns_perf_improve/</guid>
      <description>&lt;h3 id=&#34;проблема&#34;&gt;Проблема
&lt;span&gt;&lt;a href=&#34;#%d0%bf%d1%80%d0%be%d0%b1%d0%bb%d0%b5%d0%bc%d0%b0&#34;&gt;#&lt;/a&gt;&lt;/span&gt;
&lt;/h3&gt;&lt;p&gt;В нашей инсталяции при дефолтных настройках &lt;code&gt;core-dns&lt;/code&gt; не эффективно обрабатывает запросы:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;лишние попытки разрешения с суффиксами из секции search в &lt;code&gt;/etc/resolve.conf&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;резолв AAAA записей&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;Что в итоге приводит к росту latency всей системы и в целом перегружает Поды лишней работой.&lt;/p&gt;
&lt;p&gt;Перечислю основные подстройки для улучшения ситуации.&lt;/p&gt;
&lt;h3 id=&#34;отключение-резолва-аааа-записей&#34;&gt;Отключение резолва АААА записей
&lt;span&gt;&lt;a href=&#34;#%d0%be%d1%82%d0%ba%d0%bb%d1%8e%d1%87%d0%b5%d0%bd%d0%b8%d0%b5-%d1%80%d0%b5%d0%b7%d0%be%d0%bb%d0%b2%d0%b0-%d0%b0%d0%b0%d0%b0%d0%b0-%d0%b7%d0%b0%d0%bf%d0%b8%d1%81%d0%b5%d0%b9&#34;&gt;#&lt;/a&gt;&lt;/span&gt;
&lt;/h3&gt;&lt;p&gt;Вне зависимости от того используются ли ipv6 адреса в кластере или нет по дефолту &lt;code&gt;core-dns&lt;/code&gt; будет пытаться разрешать и AAAA записи в том числе.&lt;/p&gt;
&lt;p&gt;Чтобы отключить резолв AAAA записей следует добавить в конфиг:&lt;/p&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;template ANY AAAA {
    rcode NXDOMAIN
}
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;p.s. плагин &lt;code&gt;template&lt;/code&gt; включен по умолчанию.&lt;/p&gt;
&lt;h3 id=&#34;указание-имен-как-fqdn&#34;&gt;Указание имен как FQDN
&lt;span&gt;&lt;a href=&#34;#%d1%83%d0%ba%d0%b0%d0%b7%d0%b0%d0%bd%d0%b8%d0%b5-%d0%b8%d0%bc%d0%b5%d0%bd-%d0%ba%d0%b0%d0%ba-fqdn&#34;&gt;#&lt;/a&gt;&lt;/span&gt;
&lt;/h3&gt;&lt;p&gt;Как было описано в &lt;a href=&#34;https://alebsys.github.io/posts/kube-dns-resolve/#%d0%bf%d1%80%d0%be-ndots-%d0%b8-fqdn&#34;&gt;соседнем топике&lt;/a&gt;, величина &lt;code&gt;ndots&lt;/code&gt; определяет когда имя будет считаться &lt;strong&gt;FQDN&lt;/strong&gt;. Поэтому при стандартных &lt;code&gt;ndots:5&lt;/code&gt; домен &lt;code&gt;example.com&lt;/code&gt; будет резолвиться только с четвертой попытки.&lt;/p&gt;
&lt;p&gt;Для улушения ситуации можно явно задавать &lt;code&gt;.&lt;/code&gt; в конце url: &lt;code&gt;example.com.&lt;/code&gt; , тогда &lt;code&gt;example.com&lt;/code&gt; будет резолвиться с первой попытки.&lt;/p&gt;
&lt;h3 id=&#34;nodelocal-dnscache&#34;&gt;NodeLocal DNSCache
&lt;span&gt;&lt;a href=&#34;#nodelocal-dnscache&#34;&gt;#&lt;/a&gt;&lt;/span&gt;
&lt;/h3&gt;&lt;p&gt;Для ускорения трансляции имен возможно использовать локальный DNS кеш - &lt;code&gt;NodeLocal DNSCache&lt;/code&gt;.
С версии kubernetes 1.18 он вышел в stable mode.&lt;/p&gt;
&lt;p&gt;&lt;code&gt;NodeLocal DNSCache&lt;/code&gt; выступает прослойкой между клиентом и сервером DNS, располагаясь на каждой машине кластера как экземпляр &lt;code&gt;daemonSet&lt;/code&gt;.&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://alebsys.github.io/images/nodelocaldns.png&#34; alt=&#34;Цепочка dns запросов&#34;&gt;&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;Клиент посылает DNS запрос в &lt;code&gt;NodeLocal DNSCache&lt;/code&gt;;&lt;/li&gt;
&lt;li&gt;&lt;code&gt;NodeLocal DNSCache&lt;/code&gt; отвечает клиенту если ответ был закеширован, иначе&lt;/li&gt;
&lt;li&gt;&lt;code&gt;NodeLocal DNSCache&lt;/code&gt; обращается в core-dns для обновления своих данных;&lt;/li&gt;
&lt;li&gt;&lt;code&gt;NodeLocal DNSCache&lt;/code&gt; отвечает клиенту.&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;Таким образом при &amp;ldquo;удачном&amp;rdquo; обращении запрос не покидает Ноду с Подом клиента - избегает DNAT преобразований, походов по сети и как следствие разгружает core-dns Поды.&lt;/p&gt;
&lt;h3 id=&#34;dnsconfig-per-pod&#34;&gt;dnsConfig per Pod
&lt;span&gt;&lt;a href=&#34;#dnsconfig-per-pod&#34;&gt;#&lt;/a&gt;&lt;/span&gt;
&lt;/h3&gt;&lt;p&gt;Если известно, что приложение в Поде ходит только вовне, то на уровне секции &lt;a href=&#34;https://kubernetes.io/docs/concepts/services-networking/dns-pod-service/#pod-dns-config&#34;&gt;&lt;code&gt;spec.dnsConfig&lt;/code&gt;&lt;/a&gt; манифеста возможно кастомно выставить параметр &lt;code&gt;ndots&lt;/code&gt; :&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-yaml&#34; data-lang=&#34;yaml&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;apiVersion&lt;/span&gt;: &lt;span style=&#34;color:#ae81ff&#34;&gt;v1&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;kind&lt;/span&gt;: &lt;span style=&#34;color:#ae81ff&#34;&gt;Pod&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;metadata&lt;/span&gt;:
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &lt;span style=&#34;color:#f92672&#34;&gt;namespace&lt;/span&gt;: &lt;span style=&#34;color:#ae81ff&#34;&gt;default&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &lt;span style=&#34;color:#f92672&#34;&gt;name&lt;/span&gt;: &lt;span style=&#34;color:#ae81ff&#34;&gt;dns-example&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;spec&lt;/span&gt;:
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;...
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &lt;span style=&#34;color:#f92672&#34;&gt;dnsConfig&lt;/span&gt;:
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#f92672&#34;&gt;options&lt;/span&gt;:
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;      - &lt;span style=&#34;color:#f92672&#34;&gt;name&lt;/span&gt;: &lt;span style=&#34;color:#ae81ff&#34;&gt;ndots&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#f92672&#34;&gt;value&lt;/span&gt;: &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;2&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h3 id=&#34;игры-с-ndots&#34;&gt;Игры с ndots
&lt;span&gt;&lt;a href=&#34;#%d0%b8%d0%b3%d1%80%d1%8b-%d1%81-ndots&#34;&gt;#&lt;/a&gt;&lt;/span&gt;
&lt;/h3&gt;&lt;p&gt;Саму настройку ndots так же возможно изменять, подстраивая значение под глубину поддоменов принятых в организации.&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;Осторожно в кластерах k8s! Можно сломать механизмы service discovery&lt;/p&gt;
&lt;/blockquote&gt;
</description>
    </item>
    
    <item>
      <title>Resolve DNS записей в k8s</title>
      <link>https://alebsys.github.io/posts/kube-dns-resolve/</link>
      <pubDate>Wed, 14 Sep 2022 00:00:00 +0000</pubDate>
      
      <guid>https://alebsys.github.io/posts/kube-dns-resolve/</guid>
      <description>&lt;h3 id=&#34;дано&#34;&gt;Дано
&lt;span&gt;&lt;a href=&#34;#%d0%b4%d0%b0%d0%bd%d0%be&#34;&gt;#&lt;/a&gt;&lt;/span&gt;
&lt;/h3&gt;&lt;ol&gt;
&lt;li&gt;Развернутый coreDNS в кластере;&lt;/li&gt;
&lt;li&gt;Внешний по отношению к k8s DNS сервер, далее WinDNS;&lt;/li&gt;
&lt;li&gt;Произвольный Под в кластере из которого пойдет DNS-запрос.&lt;/li&gt;
&lt;/ol&gt;
&lt;h3 id=&#34;про-coredns&#34;&gt;Про CoreDNS
&lt;span&gt;&lt;a href=&#34;#%d0%bf%d1%80%d0%be-coredns&#34;&gt;#&lt;/a&gt;&lt;/span&gt;
&lt;/h3&gt;&lt;p&gt;&lt;a href=&#34;https://coredns.io/&#34;&gt;CoreDNS&lt;/a&gt; представляет собой написанный на Go DNS-сервер, использующийся для Service Discovery в кластере.&lt;/p&gt;
&lt;p&gt;Сервис модульный, в связи с чем весь функционал вынесен в отдельные плагины.
В данном тексте сосредоточимся на &lt;a href=&#34;https://coredns.io/plugins/kubernetes/&#34;&gt;&lt;code&gt;kubernetes&lt;/code&gt;&lt;/a&gt; и &lt;a href=&#34;https://coredns.io/plugins/forward/&#34;&gt;&lt;code&gt;forward&lt;/code&gt;&lt;/a&gt; плагинах:&lt;/p&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;.:53 {
    ...
    kubernetes cluster.local in-addr.arpa ip6.arpa {
       pods insecure
       fallthrough in-addr.arpa ip6.arpa
       ttl 30
    }
    ...
    forward . /etc/resolv.conf {
       max_concurrent 1000
    }
    ...
}
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;&lt;strong&gt;CoreDNS&lt;/strong&gt; отвечает за кубовую зону &lt;code&gt;cluster.local&lt;/code&gt;.
Для резолва остальных доменов задействован плагин &lt;code&gt;forward&lt;/code&gt;, конфигурация подтягивается из &lt;code&gt;/etc/resolv.conf&lt;/code&gt;.&lt;/p&gt;
&lt;h3 id=&#34;про-dnspolicy&#34;&gt;Про &lt;code&gt;dnsPolicy&lt;/code&gt;
&lt;span&gt;&lt;a href=&#34;#%d0%bf%d1%80%d0%be-dnspolicy&#34;&gt;#&lt;/a&gt;&lt;/span&gt;
&lt;/h3&gt;&lt;p&gt;Kubernetes позволяет на уровне Пода задавать &lt;a href=&#34;https://kubernetes.io/docs/concepts/services-networking/dns-pod-service/#pod-s-dns-policy&#34;&gt;&lt;code&gt;dnsPolicy&lt;/code&gt;&lt;/a&gt;, определяя настройку DNS.&lt;/p&gt;
&lt;p&gt;По умолчанию &lt;code&gt;dnsPolicy&lt;/code&gt; выставляется в значение &lt;code&gt;ClusterFirst&lt;/code&gt; - записывает в &lt;code&gt;/etc/resolv.conf&lt;/code&gt; данные о &lt;code&gt;kube-dns&lt;/code&gt; сервисе:&lt;/p&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;search namespace.svc.cluster.local svc.cluster.local cluster.local
nameserver 10.96.0.10
options ndots:5
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;Для Подов с &lt;strong&gt;CoreDNS&lt;/strong&gt; на борту требуется другая настройка, ибо он должен знать куда обращаться при разрешении доменов сторонних (не &lt;code&gt;cluster.local&lt;/code&gt;) зон.&lt;/p&gt;
&lt;p&gt;Его настройка — &lt;code&gt;dnsPolicy: Default&lt;/code&gt;, то есть в Под подтягивается &lt;code&gt;/etc/resolv.conf&lt;/code&gt; хостовой машины:&lt;/p&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;nameserver 10.96.124.1
nameserver 10.96.124.2
&lt;/code&gt;&lt;/pre&gt;&lt;h3 id=&#34;про-ndots-и-fqdn&#34;&gt;Про &lt;code&gt;ndots&lt;/code&gt; и FQDN
&lt;span&gt;&lt;a href=&#34;#%d0%bf%d1%80%d0%be-ndots-%d0%b8-fqdn&#34;&gt;#&lt;/a&gt;&lt;/span&gt;
&lt;/h3&gt;&lt;p&gt;&lt;a href=&#34;https://ru.wikipedia.org/wiki/FQDN&#34;&gt;&lt;strong&gt;FQDN&lt;/strong&gt;&lt;/a&gt; (Fully Qualified Domain Name) считается таковым если на конце присутствует &lt;code&gt;.&lt;/code&gt; . К примеру &lt;code&gt;example.com&lt;/code&gt; не является &lt;strong&gt;FQDN&lt;/strong&gt;, когда как &lt;code&gt;example.com.&lt;/code&gt; уже полноправный FQDN.&lt;/p&gt;
&lt;p&gt;Параметр &lt;code&gt;ndots&lt;/code&gt; определяет сколько в доменном имени должно присутствовать &lt;code&gt;.&lt;/code&gt; чтобы оно резолвилось как &lt;strong&gt;FQDN&lt;/strong&gt;.&lt;/p&gt;
&lt;p&gt;Т.о. если на конце доменного имени нет &lt;code&gt;.&lt;/code&gt; и/или всего &lt;code&gt;.&lt;/code&gt; меньше чем значение &lt;code&gt;ndots&lt;/code&gt;, то в начале будут последовательно резолвиться &lt;code&gt;доменное имя + суффикс&lt;/code&gt; из секции &lt;code&gt;search&lt;/code&gt; и только в конце домен как есть.&lt;/p&gt;
&lt;p&gt;Таким образом обеспечивается &lt;strong&gt;service discovery&lt;/strong&gt; в кластере &lt;strong&gt;k8s&lt;/strong&gt;, хотя и ценной более частых “промахов”.&lt;/p&gt;
&lt;h4 id=&#34;пример&#34;&gt;Пример
&lt;span&gt;&lt;a href=&#34;#%d0%bf%d1%80%d0%b8%d0%bc%d0%b5%d1%80&#34;&gt;#&lt;/a&gt;&lt;/span&gt;
&lt;/h4&gt;&lt;p&gt;Запустим в одном из Подов команду &lt;code&gt;dig example.com&lt;/code&gt;, будут сгенерированы следующие пакеты:&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;попытка резолва &lt;code&gt;example.com.namespace.svc.cluster.local&lt;/code&gt;&lt;/li&gt;
&lt;/ol&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;// 192.168.210.138 адрес Пода, 192.168.48.45 адрес Пода с CoreDNS
192.168.210.138 192.168.48.45 DNS 134 Standard query 0x28a9 A example.com.namespace.svc.cluster.local
192.168.48.45 192.168.210.138 DNS 227 Standard query response 0x28a9 No such name A example.com.namespace.svc.cluster.local SOA ns.dns.cluster.local
&lt;/code&gt;&lt;/pre&gt;&lt;ol start=&#34;2&#34;&gt;
&lt;li&gt;попытка резолва &lt;code&gt;example.com.svc.cluster.local&lt;/code&gt;&lt;/li&gt;
&lt;/ol&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;192.168.210.138 192.168.48.45 DNS 112 Standard query 0xe1f7 A example.com.svc.cluster.local
192.168.48.45 192.168.210.138 DNS 205 Standard query response 0xe1f7 No such name A example.com.svc.cluster.local SOA ns.dns.cluster.local
&lt;/code&gt;&lt;/pre&gt;&lt;ol start=&#34;3&#34;&gt;
&lt;li&gt;попытка резолва &lt;code&gt;example.com.cluster.local&lt;/code&gt;&lt;/li&gt;
&lt;/ol&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;192.168.210.138 192.168.80.33 DNS 108 Standard query 0x6f64 A example.com.cluster.local
192.168.80.33 192.168.210.138 DNS 201 Standard query response 0x6f64 No such name A example.com.cluster.local SOA ns.dns.cluster.local
&lt;/code&gt;&lt;/pre&gt;&lt;ol start=&#34;4&#34;&gt;
&lt;li&gt;попытка резолва &lt;code&gt;example.com&lt;/code&gt;&lt;/li&gt;
&lt;/ol&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;192.168.210.138 192.168.48.45 DNS 94 Standard query 0x9822 A example.com
// CoreDNS в соотвествии с плагином forward перенаправляет запрос в WinDNS 
// 10.96.70.12 - машиша с CoreDNS Подом на борту 
// 10.96.124.1 - машина с WinDNS
10.96.70.10 10.96.124.1 DNS 85 Standard query 0x3ffb A example.com OPT
10.96.124.1 10.96.70.10 DNS 101 Standard query response 0x3ffb A example.com A 93.184.216.34 OPT
// Отправка ответа целевому Поду от CoreDNS
192.168.48.45 192.168.210.138 DNS 124 Standard query response 0x9822 A example.com A 93.184.216.34
Таким образом для финального резолва нам потребовалось только на стороне DNS-клиента отправить 4 запроса, когда как всего было сгенерировано 10.
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;Визуализируем весь процесс:&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://alebsys.github.io/images/kube-dns-resolve-path.png&#34; alt=&#34;Цепочка dns запросов&#34;&gt;&lt;/p&gt;
&lt;h3 id=&#34;кастомизация-resolvconf&#34;&gt;Кастомизация &lt;code&gt;resolv.conf&lt;/code&gt;
&lt;span&gt;&lt;a href=&#34;#%d0%ba%d0%b0%d1%81%d1%82%d0%be%d0%bc%d0%b8%d0%b7%d0%b0%d1%86%d0%b8%d1%8f-resolvconf&#34;&gt;#&lt;/a&gt;&lt;/span&gt;
&lt;/h3&gt;&lt;p&gt;Директива &lt;code&gt;dnsConfig&lt;/code&gt; на уровне Пода позволяет переопределять файл &lt;code&gt;resolv.conf&lt;/code&gt;, меняя такие параметры как адреса &lt;code&gt;nameserver&lt;/code&gt;’ов, величину &lt;code&gt;ndots&lt;/code&gt;, суффиксы &lt;code&gt;search&lt;/code&gt; и подобное. Больше подробностей в &lt;a href=&#34;https://kubernetes.io/docs/concepts/services-networking/dns-pod-service/#pod-dns-config&#34;&gt;документации&lt;/a&gt;.&lt;/p&gt;
</description>
    </item>
    
    <item>
      <title>Именование объектов. Golang</title>
      <link>https://alebsys.github.io/posts/go_naming/</link>
      <pubDate>Sun, 30 Jan 2022 00:00:00 +0000</pubDate>
      
      <guid>https://alebsys.github.io/posts/go_naming/</guid>
      <description>&lt;p&gt;Конспект &lt;a href=&#34;https://dave.cheney.net/practical-go/presentations/qcon-china.html&#34;&gt;статьи&lt;/a&gt; от Dave Cheney посвященный рекомендациям по именованию объектов.&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;Слабый нейминг есть симптом слабого дизайна - Dave Cheney&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;или еще вот:&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;Хороший нейминг как хорошая шутка. Если приходится объяснять, то уже не смешно — Dave Cheney&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;Хорошо если нейминг:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;лаконичный, но краткость не вредит ясности;&lt;/li&gt;
&lt;li&gt;описывает результат функции, а не ее реализацию;&lt;/li&gt;
&lt;li&gt;позволяет без труда предугадать как и где объект используется.&lt;/li&gt;
&lt;/ul&gt;
&lt;h3 id=&#34;краткость-vs-ясность&#34;&gt;Краткость vs ясность
&lt;span&gt;&lt;a href=&#34;#%d0%ba%d1%80%d0%b0%d1%82%d0%ba%d0%be%d1%81%d1%82%d1%8c-vs-%d1%8f%d1%81%d0%bd%d0%be%d1%81%d1%82%d1%8c&#34;&gt;#&lt;/a&gt;&lt;/span&gt;
&lt;/h3&gt;&lt;blockquote&gt;
&lt;p&gt;Чем больше разнесены в коде объявление и использование объекта, тем более длинным должно быть его имя - Andrew Gerrand&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;Подходы, которых следует придерживаться:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Короткие имена назначаюся если расстояние между объявлением и крайним использованием объекта минимально, например в цикле;&lt;/li&gt;
&lt;li&gt;Использование длинного нейминга должно быть целесообразно;&lt;/li&gt;
&lt;li&gt;Не включать в имя тип объекта - врядли он сгладит плохой нейминг;&lt;/li&gt;
&lt;li&gt;Имя константы описывает значение, но не как его использовать;&lt;/li&gt;
&lt;li&gt;Односимвольные имена внутри циклов;&lt;/li&gt;
&lt;li&gt;В одно слово для параметров и возвращаемых значений функций, методов, интерфейсов и пакетов;&lt;/li&gt;
&lt;li&gt;Многословные для названий функций и объявлений на уровне пакетов;&lt;/li&gt;
&lt;li&gt;Название пакета так же является частью нейминга вызываемого объекта, используй это;&lt;/li&gt;
&lt;li&gt;Не смешивать короткие и длинные имена в одном объявлении.&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;Пример:&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-golang&#34; data-lang=&#34;golang&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;type&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;Person&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;struct&lt;/span&gt; {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;	&lt;span style=&#34;color:#a6e22e&#34;&gt;Name&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;string&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;	&lt;span style=&#34;color:#a6e22e&#34;&gt;Age&lt;/span&gt;  &lt;span style=&#34;color:#66d9ef&#34;&gt;int&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;}
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;// AverageAge returns the average age of people.
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;&lt;/span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;func&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;AverageAge&lt;/span&gt;(&lt;span style=&#34;color:#a6e22e&#34;&gt;people&lt;/span&gt; []&lt;span style=&#34;color:#a6e22e&#34;&gt;Person&lt;/span&gt;) &lt;span style=&#34;color:#66d9ef&#34;&gt;int&lt;/span&gt; {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;	&lt;span style=&#34;color:#66d9ef&#34;&gt;if&lt;/span&gt; len(&lt;span style=&#34;color:#a6e22e&#34;&gt;people&lt;/span&gt;) &lt;span style=&#34;color:#f92672&#34;&gt;==&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;0&lt;/span&gt; {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;		&lt;span style=&#34;color:#66d9ef&#34;&gt;return&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;0&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;	}
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;	&lt;span style=&#34;color:#66d9ef&#34;&gt;var&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;count&lt;/span&gt;, &lt;span style=&#34;color:#a6e22e&#34;&gt;sum&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;int&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;	&lt;span style=&#34;color:#66d9ef&#34;&gt;for&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;_&lt;/span&gt;, &lt;span style=&#34;color:#a6e22e&#34;&gt;p&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;:=&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;range&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;people&lt;/span&gt; {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;		&lt;span style=&#34;color:#a6e22e&#34;&gt;sum&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;+=&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;p&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;Age&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;		&lt;span style=&#34;color:#a6e22e&#34;&gt;count&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;+=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;1&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;	}
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;	&lt;span style=&#34;color:#66d9ef&#34;&gt;return&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;sum&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;/&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;count&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;}
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;ul&gt;
&lt;li&gt;&lt;code&gt;p&lt;/code&gt; - объявляется и используется в соседний строчках;&lt;/li&gt;
&lt;li&gt;&lt;code&gt;people&lt;/code&gt;, &lt;code&gt;count&lt;/code&gt;, &lt;code&gt;sum&lt;/code&gt; - объявляется и затем многократно используется;
&lt;ul&gt;
&lt;li&gt;если заменить &lt;code&gt;count&lt;/code&gt; на &lt;code&gt;c&lt;/code&gt; и &lt;code&gt;sum&lt;/code&gt; на &lt;code&gt;s&lt;/code&gt;, то это автоматически вынудит переименовать все переменные в программе. Врядли это добавит ясности.&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;blockquote&gt;
&lt;p&gt;Используй разделение кода пустыми строками так же как разделяется текст на абзацы. Каждый из них являет собой единое смысл, действие&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h3 id=&#34;использование-единообразных-имен&#34;&gt;Использование единообразных имен
&lt;span&gt;&lt;a href=&#34;#%d0%b8%d1%81%d0%bf%d0%be%d0%bb%d1%8c%d0%b7%d0%be%d0%b2%d0%b0%d0%bd%d0%b8%d0%b5-%d0%b5%d0%b4%d0%b8%d0%bd%d0%be%d0%be%d0%b1%d1%80%d0%b0%d0%b7%d0%bd%d1%8b%d1%85-%d0%b8%d0%bc%d0%b5%d0%bd&#34;&gt;#&lt;/a&gt;&lt;/span&gt;
&lt;/h3&gt;&lt;p&gt;Имя объекта должно быть предсказуемым. Встречая его в первый раз, читатель должен понять его смысл.&lt;/p&gt;
&lt;p&gt;Если далее по коду он встретит аналогичное имя, должна быть уверенность, что смысл объекта остался прежним.&lt;/p&gt;
&lt;p&gt;Вместо  &lt;code&gt;d *sql.DB&lt;/code&gt;, &lt;code&gt;dbase *sql.DB&lt;/code&gt;, &lt;code&gt;DB *sql.DB&lt;/code&gt; обозначающих одно и тоже стоит выбрать единый, например &lt;code&gt;db *sql.DB&lt;/code&gt;.&lt;/p&gt;
&lt;p&gt;Тоже самое валидно и для получателей значений из функций и методов.&lt;/p&gt;
&lt;p&gt;Традиционно односимвольные имена используются в циклах, где:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;code&gt;i&lt;/code&gt; (&lt;code&gt;j&lt;/code&gt;) - индекс в цикле, j используется для вложенных циклов;&lt;/li&gt;
&lt;li&gt;&lt;code&gt;k&lt;/code&gt;, &lt;code&gt;v&lt;/code&gt; - ключ/значение в map;&lt;/li&gt;
&lt;li&gt;&lt;code&gt;n&lt;/code&gt; часто ассоциируется со счетчиком (возврастает);&lt;/li&gt;
&lt;li&gt;&lt;code&gt;s&lt;/code&gt; для обозначения string.&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;Таким образом читатель встретив &lt;code&gt;i&lt;/code&gt; или &lt;code&gt;j&lt;/code&gt; будет предполагать, что он находится в цикле.&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;Если ты очнулся обложенным кучей &lt;code&gt;i&lt;/code&gt; и &lt;code&gt;j&lt;/code&gt;, то самое время задуматься над вынесеннием функционала в отдельные модули&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h3 id=&#34;варианты-объявления-переменных&#34;&gt;Варианты объявления переменных
&lt;span&gt;&lt;a href=&#34;#%d0%b2%d0%b0%d1%80%d0%b8%d0%b0%d0%bd%d1%82%d1%8b-%d0%be%d0%b1%d1%8a%d1%8f%d0%b2%d0%bb%d0%b5%d0%bd%d0%b8%d1%8f-%d0%bf%d0%b5%d1%80%d0%b5%d0%bc%d0%b5%d0%bd%d0%bd%d1%8b%d1%85&#34;&gt;#&lt;/a&gt;&lt;/span&gt;
&lt;/h3&gt;&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;Когда переменная дикларируется без инициализации (будет сделано позже), используй var:&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-golang&#34; data-lang=&#34;golang&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;var&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;players&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;int&lt;/span&gt;    &lt;span style=&#34;color:#75715e&#34;&gt;// 0
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;var&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;things&lt;/span&gt; []&lt;span style=&#34;color:#a6e22e&#34;&gt;Thing&lt;/span&gt; &lt;span style=&#34;color:#75715e&#34;&gt;// an empty slice of Things
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;var&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;thing&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;Thing&lt;/span&gt;    &lt;span style=&#34;color:#75715e&#34;&gt;// empty Thing struct
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;&lt;/span&gt;&lt;span style=&#34;color:#a6e22e&#34;&gt;json&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;Unmarshall&lt;/span&gt;(&lt;span style=&#34;color:#a6e22e&#34;&gt;reader&lt;/span&gt;, &lt;span style=&#34;color:#f92672&#34;&gt;&amp;amp;&lt;/span&gt;&lt;span style=&#34;color:#a6e22e&#34;&gt;thing&lt;/span&gt;)
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;Когда требуется в том числе и явная инициализация - используй &lt;code&gt;:=&lt;/code&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
</description>
    </item>
    
    <item>
      <title>REST API на golang. Часть первая</title>
      <link>https://alebsys.github.io/posts/restapi_golang_1/</link>
      <pubDate>Sat, 08 Jan 2022 00:00:00 +0000</pubDate>
      
      <guid>https://alebsys.github.io/posts/restapi_golang_1/</guid>
      <description>&lt;h3 id=&#34;преамбула&#34;&gt;Преамбула
&lt;span&gt;&lt;a href=&#34;#%d0%bf%d1%80%d0%b5%d0%b0%d0%bc%d0%b1%d1%83%d0%bb%d0%b0&#34;&gt;#&lt;/a&gt;&lt;/span&gt;
&lt;/h3&gt;&lt;p&gt;На &lt;strong&gt;YouTube&lt;/strong&gt; мне попался толковый курс &lt;a href=&#34;https://www.youtube.com/playlist?list=PLmD8u-IFdreyh6EUfevBcbiuCKzFk0EW_&#34;&gt;Building Microservices with Go&lt;/a&gt; от Nic Jackson. Параллельно с изучением буду писать небольшие заметки.&lt;/p&gt;
&lt;h3 id=&#34;часть-первая&#34;&gt;Часть первая
&lt;span&gt;&lt;a href=&#34;#%d1%87%d0%b0%d1%81%d1%82%d1%8c-%d0%bf%d0%b5%d1%80%d0%b2%d0%b0%d1%8f&#34;&gt;#&lt;/a&gt;&lt;/span&gt;
&lt;/h3&gt;&lt;p&gt;В первой части познакомимся с азами &lt;a href=&#34;https://pkg.go.dev/net/http&#34;&gt;http&lt;/a&gt; пакета и построим простой, но вполне рабочий вебсервер.&lt;/p&gt;
&lt;p&gt;Примером выступит:&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-golang&#34; data-lang=&#34;golang&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;package&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;main&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;import&lt;/span&gt; (
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;	&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;fmt&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;	&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;io/ioutil&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;	&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;log&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;	&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;net/http&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;func&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;handlerHello&lt;/span&gt;(&lt;span style=&#34;color:#a6e22e&#34;&gt;w&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;http&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;ResponseWriter&lt;/span&gt;, &lt;span style=&#34;color:#a6e22e&#34;&gt;r&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;*&lt;/span&gt;&lt;span style=&#34;color:#a6e22e&#34;&gt;http&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;Request&lt;/span&gt;) {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;	&lt;span style=&#34;color:#a6e22e&#34;&gt;log&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;Println&lt;/span&gt;(&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;request to /hello&amp;#34;&lt;/span&gt;)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;	&lt;span style=&#34;color:#a6e22e&#34;&gt;data&lt;/span&gt;, &lt;span style=&#34;color:#a6e22e&#34;&gt;err&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;:=&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;ioutil&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;ReadAll&lt;/span&gt;(&lt;span style=&#34;color:#a6e22e&#34;&gt;r&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;Body&lt;/span&gt;)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;	&lt;span style=&#34;color:#66d9ef&#34;&gt;if&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;err&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;!=&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;nil&lt;/span&gt; {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;			&lt;span style=&#34;color:#a6e22e&#34;&gt;http&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;Error&lt;/span&gt;(&lt;span style=&#34;color:#a6e22e&#34;&gt;w&lt;/span&gt;, &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;error while reading request body&amp;#34;&lt;/span&gt;, &lt;span style=&#34;color:#a6e22e&#34;&gt;http&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;StatusInternalServerError&lt;/span&gt;)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;			&lt;span style=&#34;color:#66d9ef&#34;&gt;return&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;	}
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;	&lt;span style=&#34;color:#66d9ef&#34;&gt;if&lt;/span&gt; string(&lt;span style=&#34;color:#a6e22e&#34;&gt;data&lt;/span&gt;) &lt;span style=&#34;color:#f92672&#34;&gt;==&lt;/span&gt; &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;&amp;#34;&lt;/span&gt; {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;		&lt;span style=&#34;color:#a6e22e&#34;&gt;http&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;Error&lt;/span&gt;(&lt;span style=&#34;color:#a6e22e&#34;&gt;w&lt;/span&gt;, &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;error: body is empty&amp;#34;&lt;/span&gt;, &lt;span style=&#34;color:#a6e22e&#34;&gt;http&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;StatusBadRequest&lt;/span&gt;)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;		&lt;span style=&#34;color:#66d9ef&#34;&gt;return&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;	}
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;	&lt;span style=&#34;color:#a6e22e&#34;&gt;fmt&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;Fprintf&lt;/span&gt;(&lt;span style=&#34;color:#a6e22e&#34;&gt;w&lt;/span&gt;, &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;Hello %s&amp;#34;&lt;/span&gt;, &lt;span style=&#34;color:#a6e22e&#34;&gt;data&lt;/span&gt;)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;}
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;func&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;handlerBye&lt;/span&gt;(&lt;span style=&#34;color:#a6e22e&#34;&gt;w&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;http&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;ResponseWriter&lt;/span&gt;, &lt;span style=&#34;color:#a6e22e&#34;&gt;r&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;*&lt;/span&gt;&lt;span style=&#34;color:#a6e22e&#34;&gt;http&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;Request&lt;/span&gt;) {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;	&lt;span style=&#34;color:#a6e22e&#34;&gt;log&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;Println&lt;/span&gt;(&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;request to /bye&amp;#34;&lt;/span&gt;)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;	&lt;span style=&#34;color:#a6e22e&#34;&gt;data&lt;/span&gt;, &lt;span style=&#34;color:#a6e22e&#34;&gt;err&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;:=&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;ioutil&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;ReadAll&lt;/span&gt;(&lt;span style=&#34;color:#a6e22e&#34;&gt;r&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;Body&lt;/span&gt;)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;	&lt;span style=&#34;color:#66d9ef&#34;&gt;if&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;err&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;!=&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;nil&lt;/span&gt; {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;		&lt;span style=&#34;color:#a6e22e&#34;&gt;http&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;Error&lt;/span&gt;(&lt;span style=&#34;color:#a6e22e&#34;&gt;w&lt;/span&gt;, &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;error while reading request body&amp;#34;&lt;/span&gt;, &lt;span style=&#34;color:#a6e22e&#34;&gt;http&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;StatusInternalServerError&lt;/span&gt;)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;		&lt;span style=&#34;color:#66d9ef&#34;&gt;return&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;	}
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;	&lt;span style=&#34;color:#66d9ef&#34;&gt;if&lt;/span&gt; string(&lt;span style=&#34;color:#a6e22e&#34;&gt;data&lt;/span&gt;) &lt;span style=&#34;color:#f92672&#34;&gt;==&lt;/span&gt; &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;&amp;#34;&lt;/span&gt; {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;		&lt;span style=&#34;color:#a6e22e&#34;&gt;http&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;Error&lt;/span&gt;(&lt;span style=&#34;color:#a6e22e&#34;&gt;w&lt;/span&gt;, &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;error: body is empty&amp;#34;&lt;/span&gt;, &lt;span style=&#34;color:#a6e22e&#34;&gt;http&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;StatusBadRequest&lt;/span&gt;)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;		&lt;span style=&#34;color:#66d9ef&#34;&gt;return&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;	}
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;	&lt;span style=&#34;color:#a6e22e&#34;&gt;fmt&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;Fprintf&lt;/span&gt;(&lt;span style=&#34;color:#a6e22e&#34;&gt;w&lt;/span&gt;, &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;Bye %s&amp;#34;&lt;/span&gt;, &lt;span style=&#34;color:#a6e22e&#34;&gt;data&lt;/span&gt;)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;}
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;func&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;main&lt;/span&gt;() {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;	
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;	&lt;span style=&#34;color:#a6e22e&#34;&gt;http&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;HandleFunc&lt;/span&gt;(&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;/hello&amp;#34;&lt;/span&gt;, &lt;span style=&#34;color:#a6e22e&#34;&gt;handlerHello&lt;/span&gt;)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;	&lt;span style=&#34;color:#a6e22e&#34;&gt;http&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;HandleFunc&lt;/span&gt;(&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;/bye&amp;#34;&lt;/span&gt;, &lt;span style=&#34;color:#a6e22e&#34;&gt;handlerBye&lt;/span&gt;)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;	&lt;span style=&#34;color:#a6e22e&#34;&gt;http&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;ListenAndServe&lt;/span&gt;(&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;:9090&amp;#34;&lt;/span&gt;, &lt;span style=&#34;color:#66d9ef&#34;&gt;nil&lt;/span&gt;)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;}
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;Приступим.&lt;/p&gt;
&lt;h3 id=&#34;точка-входа-listenandserve&#34;&gt;Точка входа. ListenAndServe()
&lt;span&gt;&lt;a href=&#34;#%d1%82%d0%be%d1%87%d0%ba%d0%b0-%d0%b2%d1%85%d0%be%d0%b4%d0%b0-listenandserve&#34;&gt;#&lt;/a&gt;&lt;/span&gt;
&lt;/h3&gt;&lt;p&gt;Начнем с определения функции:&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-golang&#34; data-lang=&#34;golang&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;func&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;http&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;ListenAndServe&lt;/span&gt;(&lt;span style=&#34;color:#a6e22e&#34;&gt;addr&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;string&lt;/span&gt;, &lt;span style=&#34;color:#a6e22e&#34;&gt;handler&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;http&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;Handler&lt;/span&gt;) &lt;span style=&#34;color:#66d9ef&#34;&gt;error&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;&lt;a href=&#34;https://pkg.go.dev/net/http@go1.17.6#Server.ListenAndServe&#34;&gt;&lt;code&gt;ListenAndServe()&lt;/code&gt;&lt;/a&gt; принимает в качестве параметров &lt;code&gt;addr&lt;/code&gt; и обработчик &lt;code&gt;handler&lt;/code&gt;, где:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;code&gt;addr&lt;/code&gt; - адрес и порт которые &amp;ldquo;слушает&amp;rdquo; вебсервер;&lt;/li&gt;
&lt;li&gt;&lt;code&gt;handler&lt;/code&gt; - обработчик, чья задача, как следует из названия, обрабатывать входящие запросы.&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;В нашем случае:&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-golang&#34; data-lang=&#34;golang&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#a6e22e&#34;&gt;http&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;ListenAndServe&lt;/span&gt;(&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;:9090&amp;#34;&lt;/span&gt;, &lt;span style=&#34;color:#66d9ef&#34;&gt;nil&lt;/span&gt;)
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;ul&gt;
&lt;li&gt;Веб-сервер ожидает подключений на 9090 порту с любых адресов;&lt;/li&gt;
&lt;li&gt;Конкретный &lt;code&gt;handler&lt;/code&gt; не определен (&lt;code&gt;nil&lt;/code&gt;), поэтому будет использоваться стандартный - &lt;code&gt;DefaultServeMux&lt;/code&gt;. В будущем коснемся этой темы.&lt;/li&gt;
&lt;/ul&gt;
&lt;h3 id=&#34;что-есть-handler&#34;&gt;Что есть Handler
&lt;span&gt;&lt;a href=&#34;#%d1%87%d1%82%d0%be-%d0%b5%d1%81%d1%82%d1%8c-handler&#34;&gt;#&lt;/a&gt;&lt;/span&gt;
&lt;/h3&gt;&lt;p&gt;&lt;a href=&#34;https://pkg.go.dev/net/http@go1.17.6#Handler&#34;&gt;&lt;code&gt;Handler&lt;/code&gt;&lt;/a&gt; под капотом являет собой тип &lt;code&gt;interface&lt;/code&gt;:&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-golang&#34; data-lang=&#34;golang&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;type&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;Handler&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;interface&lt;/span&gt; {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;	&lt;span style=&#34;color:#a6e22e&#34;&gt;ServeHTTP&lt;/span&gt;(&lt;span style=&#34;color:#a6e22e&#34;&gt;ResponseWriter&lt;/span&gt;, &lt;span style=&#34;color:#f92672&#34;&gt;*&lt;/span&gt;&lt;span style=&#34;color:#a6e22e&#34;&gt;Request&lt;/span&gt;)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;}
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;Метод &lt;code&gt;ServeHTTP()&lt;/code&gt; принимает &lt;a href=&#34;https://pkg.go.dev/net/http@go1.17.6#Request&#34;&gt;&lt;code&gt;Request&lt;/code&gt;&lt;/a&gt; (структура) и пишет ответ в &lt;a href=&#34;https://pkg.go.dev/net/http@go1.17.6#ResponseWriter&#34;&gt;&lt;code&gt;ResponseWriter&lt;/code&gt;&lt;/a&gt; (так же интерфейс).&lt;/p&gt;
&lt;p&gt;В целом логика следующая:&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;поступает новый запрос по &lt;code&gt;url&lt;/code&gt; &lt;code&gt;&amp;lt;SERVER_ADDRESS&amp;gt;:9090/hello&lt;/code&gt; ;&lt;/li&gt;
&lt;li&gt;&lt;code&gt;ListenAndServe()&lt;/code&gt; вызывает обработчик &lt;code&gt;handlerHello&lt;/code&gt;, так как путь &lt;code&gt;/hello&lt;/code&gt; совпадает с его &lt;code&gt;pattern&lt;/code&gt;.&lt;/li&gt;
&lt;/ol&gt;
&lt;h3 id=&#34;регистрация-handler&#34;&gt;Регистрация handler
&lt;span&gt;&lt;a href=&#34;#%d1%80%d0%b5%d0%b3%d0%b8%d1%81%d1%82%d1%80%d0%b0%d1%86%d0%b8%d1%8f-handler&#34;&gt;#&lt;/a&gt;&lt;/span&gt;
&lt;/h3&gt;&lt;p&gt;Перед использованием, следует зарегистрировать обработчик через функцию &lt;a href=&#34;https://pkg.go.dev/net/http@go1.17.6#HandleFunc&#34;&gt;&lt;code&gt;HandleFunc()&lt;/code&gt;&lt;/a&gt;:&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-golang&#34; data-lang=&#34;golang&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;func&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;http&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;HandleFunc&lt;/span&gt;(&lt;span style=&#34;color:#a6e22e&#34;&gt;pattern&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;string&lt;/span&gt;, &lt;span style=&#34;color:#a6e22e&#34;&gt;handler&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;func&lt;/span&gt;(&lt;span style=&#34;color:#a6e22e&#34;&gt;http&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;ResponseWriter&lt;/span&gt;, &lt;span style=&#34;color:#f92672&#34;&gt;*&lt;/span&gt;&lt;span style=&#34;color:#a6e22e&#34;&gt;http&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;Request&lt;/span&gt;))
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;ul&gt;
&lt;li&gt;&lt;code&gt;pattern&lt;/code&gt; - проверяет соответствие пути запроса. Подробнее в &lt;a href=&#34;https://ru.wikipedia.org/wiki/URL#%D0%A1%D1%82%D1%80%D1%83%D0%BA%D1%82%D1%83%D1%80%D0%B0_URL&#34;&gt;Wiki&lt;/a&gt;;&lt;/li&gt;
&lt;li&gt;&lt;code&gt;handler&lt;/code&gt; - определенный экземпляр обработчика.&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;Подобных функций может быть сколь угодно много. Таким образом для обработки запроса будет вызываться тот &lt;code&gt;handler&lt;/code&gt; чей &lt;code&gt;pattern&lt;/code&gt; будет наиболее близок к значению пути в &lt;code&gt;url&lt;/code&gt;.&lt;/p&gt;
&lt;p&gt;В нашей программе объявлено два &lt;code&gt;handler&lt;/code&gt;&amp;lsquo;а:&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-golang&#34; data-lang=&#34;golang&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#a6e22e&#34;&gt;http&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;HandleFunc&lt;/span&gt;(&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;/hello&amp;#34;&lt;/span&gt;, &lt;span style=&#34;color:#a6e22e&#34;&gt;handlerHello&lt;/span&gt;)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#a6e22e&#34;&gt;http&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;HandleFunc&lt;/span&gt;(&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;/bye&amp;#34;&lt;/span&gt;, &lt;span style=&#34;color:#a6e22e&#34;&gt;handlerBye&lt;/span&gt;)
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;Поэтому запрос на &lt;code&gt;&amp;lt;SERVER_ADDRESS&amp;gt;:9090/hello&lt;/code&gt; обработается &lt;code&gt;handlerHello&lt;/code&gt;, а &lt;code&gt;handlerBye&lt;/code&gt; возьмется за &lt;code&gt;&amp;lt;SERVER_ADDRESS&amp;gt;:9090/bye&lt;/code&gt;.&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;Подробнее про сопоставление пути в &lt;code&gt;url&lt;/code&gt; с &lt;code&gt;pattern&lt;/code&gt; читай в &lt;a href=&#34;https://pkg.go.dev/net/http#ServeMux&#34;&gt;документации&lt;/a&gt; к пакету.&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h3 id=&#34;запрос---ответ&#34;&gt;Запрос - ответ
&lt;span&gt;&lt;a href=&#34;#%d0%b7%d0%b0%d0%bf%d1%80%d0%be%d1%81---%d0%be%d1%82%d0%b2%d0%b5%d1%82&#34;&gt;#&lt;/a&gt;&lt;/span&gt;
&lt;/h3&gt;&lt;p&gt;Пробежимся по реализации &lt;code&gt;handlerHello()&lt;/code&gt;:&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-golang&#34; data-lang=&#34;golang&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;func&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;handlerHello&lt;/span&gt;(&lt;span style=&#34;color:#a6e22e&#34;&gt;w&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;http&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;ResponseWriter&lt;/span&gt;, &lt;span style=&#34;color:#a6e22e&#34;&gt;r&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;*&lt;/span&gt;&lt;span style=&#34;color:#a6e22e&#34;&gt;http&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;Request&lt;/span&gt;) {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;	&lt;span style=&#34;color:#a6e22e&#34;&gt;log&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;Println&lt;/span&gt;(&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;request to /hello&amp;#34;&lt;/span&gt;)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;	&lt;span style=&#34;color:#a6e22e&#34;&gt;data&lt;/span&gt;, &lt;span style=&#34;color:#a6e22e&#34;&gt;err&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;:=&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;ioutil&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;ReadAll&lt;/span&gt;(&lt;span style=&#34;color:#a6e22e&#34;&gt;r&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;Body&lt;/span&gt;)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;	&lt;span style=&#34;color:#66d9ef&#34;&gt;if&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;err&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;!=&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;nil&lt;/span&gt; {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;		&lt;span style=&#34;color:#a6e22e&#34;&gt;http&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;Error&lt;/span&gt;(&lt;span style=&#34;color:#a6e22e&#34;&gt;w&lt;/span&gt;, &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;error while reading request body&amp;#34;&lt;/span&gt;, &lt;span style=&#34;color:#a6e22e&#34;&gt;http&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;StatusInternalServerError&lt;/span&gt;)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;		&lt;span style=&#34;color:#66d9ef&#34;&gt;return&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;	}
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;	&lt;span style=&#34;color:#66d9ef&#34;&gt;if&lt;/span&gt; string(&lt;span style=&#34;color:#a6e22e&#34;&gt;data&lt;/span&gt;) &lt;span style=&#34;color:#f92672&#34;&gt;==&lt;/span&gt; &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;&amp;#34;&lt;/span&gt; {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;		&lt;span style=&#34;color:#a6e22e&#34;&gt;http&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;Error&lt;/span&gt;(&lt;span style=&#34;color:#a6e22e&#34;&gt;w&lt;/span&gt;, &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;error: body is empty&amp;#34;&lt;/span&gt;, &lt;span style=&#34;color:#a6e22e&#34;&gt;http&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;StatusBadRequest&lt;/span&gt;)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;		&lt;span style=&#34;color:#66d9ef&#34;&gt;return&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;	}
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;	&lt;span style=&#34;color:#a6e22e&#34;&gt;fmt&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;Fprintf&lt;/span&gt;(&lt;span style=&#34;color:#a6e22e&#34;&gt;w&lt;/span&gt;, &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;Hello %s&amp;#34;&lt;/span&gt;, &lt;span style=&#34;color:#a6e22e&#34;&gt;data&lt;/span&gt;)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;}
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;ol&gt;
&lt;li&gt;Логируем поступление запроса на обработчик;&lt;/li&gt;
&lt;li&gt;Пишем в переменную &lt;code&gt;data&lt;/code&gt; тело запроса;&lt;/li&gt;
&lt;li&gt;Проверяем ошибки в шаге (2). При их наличии пишем в &lt;code&gt;w&lt;/code&gt;, читай отправляем клиенту, причину, код ошибки и выходим из функции;&lt;/li&gt;
&lt;li&gt;Если ошибок нет, отправляем в &lt;code&gt;w&lt;/code&gt; ответ.&lt;/li&gt;
&lt;/ol&gt;
&lt;blockquote&gt;
&lt;p&gt;Стоит заметить, что функция &lt;code&gt;fmt.Fprintf()&lt;/code&gt; принимает первым параметром интерфейс &lt;code&gt;w io.Writer&lt;/code&gt;. И так как &lt;code&gt;http.ResponseWriter&lt;/code&gt; реализует метод &lt;code&gt;Write()&lt;/code&gt;, то мы вполне успешно можем подставить его в функцию.&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;Запустим наш код и отправим запросы к веб-серверу:&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;curl 127.0.0.1:9090/hello -d &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#39;World&amp;#39;&lt;/span&gt; &lt;span style=&#34;color:#75715e&#34;&gt;# отправляем запрос на /hello&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;Hello World &lt;span style=&#34;color:#75715e&#34;&gt;# получаем ответ от веб-сервера&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;curl 127.0.0.1:9090/bye -d &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#39;World&amp;#39;&lt;/span&gt; &lt;span style=&#34;color:#75715e&#34;&gt;# отправляем запрос на /bye&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;Bye World &lt;span style=&#34;color:#75715e&#34;&gt;# получаем ответ от веб-сервера&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;До встречи!&lt;/p&gt;
</description>
    </item>
    
  </channel>
</rss>
