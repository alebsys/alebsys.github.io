<!doctype html><html lang=en dir=auto><head><meta charset=utf-8><meta http-equiv=X-UA-Compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>Long way to the application, ‚Ññ1. | Performance Matters</title>
<meta name=keywords content="network,linux,virtualization,tcp,tuning"><meta name=description content="–ü—Ä–µ–∂–¥–µ —á–µ–º —Å–µ—Ç–µ–≤–æ–π –ø–∞–∫–µ—Ç –∏–∑ —Å–µ—Ä–≤–∏—Å–∞ –ê –ø–æ–ø–∞–¥–µ—Ç –≤ —Å–µ—Ä–≤–∏—Å –ë, –µ–º—É —Å–ª–µ–¥—É–µ—Ç –º–∏–Ω–æ–≤–∞—Ç—å –º–Ω–æ–∂–µ—Å—Ç–≤–æ —Å–∏—Å—Ç–µ–º –ø–æ —Å–µ—Ä–µ–¥–∏–Ω–µ&mldr;"><meta name=author content><link rel=canonical href=https://alebsys.github.io/posts/long-way-to-the-app-1/><meta name=google-site-verification content="XYZabc"><meta name=yandex-verification content="XYZabc"><meta name=msvalidate.01 content="XYZabc"><link crossorigin=anonymous href=/assets/css/stylesheet.27100688bec44e71d90b7169778c0eac3af72cdb83d2fd2b79510e30556bd171.css integrity="sha256-JxAGiL7ETnHZC3Fpd4wOrDr3LNuD0v0reVEOMFVr0XE=" rel="preload stylesheet" as=style><link rel=icon href=https://alebsys.github.io/images/favicon.ico><link rel=icon type=image/png sizes=16x16 href=https://alebsys.github.io/%3Clink%20/%20abs%20url%3E><link rel=icon type=image/png sizes=32x32 href=https://alebsys.github.io/%3Clink%20/%20abs%20url%3E><link rel=apple-touch-icon href=https://alebsys.github.io/%3Clink%20/%20abs%20url%3E><link rel=mask-icon href=https://alebsys.github.io/%3Clink%20/%20abs%20url%3E><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><link rel=alternate hreflang=en href=https://alebsys.github.io/posts/long-way-to-the-app-1/><noscript><style>#theme-toggle,.top-link{display:none}</style><style>@media(prefers-color-scheme:dark){:root{--theme:rgb(29, 30, 32);--entry:rgb(46, 46, 51);--primary:rgb(218, 218, 219);--secondary:rgb(155, 156, 157);--tertiary:rgb(65, 66, 68);--content:rgb(196, 196, 197);--code-block-bg:rgb(46, 46, 51);--code-bg:rgb(55, 56, 62);--border:rgb(51, 51, 51)}.list{background:var(--theme)}.list:not(.dark)::-webkit-scrollbar-track{background:0 0}.list:not(.dark)::-webkit-scrollbar-thumb{border-color:var(--theme)}}</style></noscript><script async src="https://www.googletagmanager.com/gtag/js?id=G-98549RKLMS"></script><script>var dnt,doNotTrack=!1;if(!1&&(dnt=navigator.doNotTrack||window.doNotTrack||navigator.msDoNotTrack,doNotTrack=dnt=="1"||dnt=="yes"),!doNotTrack){window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","G-98549RKLMS")}</script><meta property="og:title" content="Long way to the application, ‚Ññ1."><meta property="og:description" content="–ü—Ä–µ–∂–¥–µ —á–µ–º —Å–µ—Ç–µ–≤–æ–π –ø–∞–∫–µ—Ç –∏–∑ —Å–µ—Ä–≤–∏—Å–∞ –ê –ø–æ–ø–∞–¥–µ—Ç –≤ —Å–µ—Ä–≤–∏—Å –ë, –µ–º—É —Å–ª–µ–¥—É–µ—Ç –º–∏–Ω–æ–≤–∞—Ç—å –º–Ω–æ–∂–µ—Å—Ç–≤–æ —Å–∏—Å—Ç–µ–º –ø–æ —Å–µ—Ä–µ–¥–∏–Ω–µ&mldr;"><meta property="og:type" content="article"><meta property="og:url" content="https://alebsys.github.io/posts/long-way-to-the-app-1/"><meta property="article:section" content="posts"><meta property="article:published_time" content="2024-04-21T00:00:00+00:00"><meta property="article:modified_time" content="2024-04-21T00:00:00+00:00"><meta name=twitter:card content="summary"><meta name=twitter:title content="Long way to the application, ‚Ññ1."><meta name=twitter:description content="–ü—Ä–µ–∂–¥–µ —á–µ–º —Å–µ—Ç–µ–≤–æ–π –ø–∞–∫–µ—Ç –∏–∑ —Å–µ—Ä–≤–∏—Å–∞ –ê –ø–æ–ø–∞–¥–µ—Ç –≤ —Å–µ—Ä–≤–∏—Å –ë, –µ–º—É —Å–ª–µ–¥—É–µ—Ç –º–∏–Ω–æ–≤–∞—Ç—å –º–Ω–æ–∂–µ—Å—Ç–≤–æ —Å–∏—Å—Ç–µ–º –ø–æ —Å–µ—Ä–µ–¥–∏–Ω–µ&mldr;"><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"Posts","item":"https://alebsys.github.io/posts/"},{"@type":"ListItem","position":2,"name":"Long way to the application, ‚Ññ1.","item":"https://alebsys.github.io/posts/long-way-to-the-app-1/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"Long way to the application, ‚Ññ1.","name":"Long way to the application, ‚Ññ1.","description":"–ü—Ä–µ–∂–¥–µ —á–µ–º —Å–µ—Ç–µ–≤–æ–π –ø–∞–∫–µ—Ç –∏–∑ —Å–µ—Ä–≤–∏—Å–∞ –ê –ø–æ–ø–∞–¥–µ—Ç –≤ —Å–µ—Ä–≤–∏—Å –ë, –µ–º—É —Å–ª–µ–¥—É–µ—Ç –º–∏–Ω–æ–≤–∞—Ç—å –º–Ω–æ–∂–µ—Å—Ç–≤–æ —Å–∏—Å—Ç–µ–º –ø–æ —Å–µ—Ä–µ–¥–∏–Ω–µ\u0026hellip;","keywords":["network","linux","virtualization","tcp","tuning"],"articleBody":"UPD:\n14.05.24 - –¥–æ–±–∞–≤–∏–ª –±–ª–æ–∫-—Å—Ö–µ–º—É –¥–≤–∏–∂–µ–Ω–∏—è –ø–∞–∫–µ—Ç–∞ –ø–æ –æ—á–µ—Ä–µ–¥—è–º; 01.05.24 - –æ–±–Ω–æ–≤–∏–ª –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –ø–æ –¥–µ—è—Ç–µ–ª—å–Ω–æ—Å—Ç–∏ softirqd. –ü—Ä–µ–∂–¥–µ —á–µ–º —Å–µ—Ç–µ–≤–æ–π –ø–∞–∫–µ—Ç –∏–∑ —Å–µ—Ä–≤–∏—Å–∞ –ê –ø–æ–ø–∞–¥–µ—Ç –≤ —Å–µ—Ä–≤–∏—Å –ë, –µ–º—É —Å–ª–µ–¥—É–µ—Ç –º–∏–Ω–æ–≤–∞—Ç—å –º–Ω–æ–∂–µ—Å—Ç–≤–æ —Å–∏—Å—Ç–µ–º –ø–æ —Å–µ—Ä–µ–¥–∏–Ω–µ, –≥–¥–µ –æ–Ω —Å–¥–µ–ª–∞–µ—Ç –Ω–∏ –æ–¥–Ω—É –æ—Å—Ç–∞–Ω–æ–≤–∫—É.\n–ò, —á—Ç–æ —Å–∞–º–æ–µ –∏–Ω—Ç–µ—Ä–µ—Å–Ω–æ–µ, –Ω–∏–∫—Ç–æ (–∏–ª–∏ –Ω–∏—á—Ç–æ) –Ω–µ –≥–∞—Ä–∞–Ω—Ç–∏—Ä—É–µ–º –µ–º—É —É—Å–ø–µ—Ö –≤ –∫–æ–Ω–µ—á–Ω–æ —Å—á–µ—Ç–µ.\n–û–ø–∏—Å–∞—Ç—å –ø–æ–ª–Ω—ã–π –ø—É—Ç—å –º–Ω–µ –Ω–µ —Ö–≤–∞—Ç–∏—Ç –Ω–∏ –∑–Ω–∞–Ω–∏–π, –Ω–∏ —Ç–µ—Ä–ø–µ–Ω–∏—è, –ø–æ—ç—Ç–æ–º—É —Å–æ—Å—Ä–µ–¥–æ—Ç–æ—á—É—Å—å —Ç–æ–ª—å–∫–æ –Ω–∞ –∫–æ–Ω–µ—á–Ω–æ–π —á–∞—Å—Ç–∏ –º–∞—Ä—à—Ä—É—Ç–∞ - –ø–∞–∫–µ—Ç –ø—Ä–∏–±—ã–ª –Ω–∞ —Ü–µ–ª–µ–≤–æ–π –•–æ—Å—Ç, –≥–¥–µ –∂–∏–≤–µ—Ç —Å–µ—Ä–≤–∏—Å –ë.\n–¶–µ–ª–∏ –∑–∞–º–µ—Ç–∫–∏:\n–ø–æ–∫–∞–∑–∞—Ç—å —á–µ—Ä–µ–∑ –∫–∞–∫–∏–µ –æ—Å—Ç–∞–Ω–æ–≤–∫–∏, —Å—á–∏—Ç–∞–π –æ—á–µ—Ä–µ–¥–∏, –ø—Ä–æ—Ö–æ–¥–∏—Ç —Å–µ—Ç–µ–≤–æ–π –ø–∞–∫–µ—Ç –ø—Ä–µ–∂–¥–µ —á–µ–º –¥–æ—Å—Ç–∏–≥–Ω–µ—Ç –ø–æ–ª—É—á–∞—Ç–µ–ª—è; –∫–∞–∫ –º—ã –º–æ–∂–µ–º —ç—Ç–∏ –æ—á–µ—Ä–µ–¥–∏ –º–æ–Ω–∏—Ç–æ—Ä–∏—Ç—å –∏ –∫–∞–∫ –Ω–∞ –Ω–∏—Ö –≤–ª–∏—è—Ç—å. –í–≤–æ–¥–Ω—ã–µ - –æ–±—â–µ–Ω–∏–µ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç –ø–æ TCP –ø—Ä–æ—Ç–æ–∫–æ–ª—É, –≥–¥–µ –∫–æ–Ω–µ—á–Ω—ã–π –•–æ—Å—Ç —Ä–∞–±–æ—Ç–∞–µ—Ç –ø–æ–¥ Linux. –ò –ø—É—Å—Ç—å —ç—Ç–æ –±—É–¥–µ—Ç –≤–∏—Ä—Ç—É–∞–ª—å–Ω–∞—è –º–∞—à–∏–Ω–∞.\n–ò —Ç–∞–∫, –ø–∞–∫–µ—Ç –ø—Ä–∏–±—ã–ª –Ω–∞ –•–æ—Å—Ç‚Ä¶ –ü–µ—Ä–≤—ã–º –¥–µ–ª–æ–º –æ–Ω –ø–æ–ø–∞–¥–∞–µ—Ç –≤ —Å–µ—Ç–µ–≤—É—é –∫–∞—Ä—Ç—É (NIC). –ß–µ—Ä–µ–∑ DMA —Å–µ—Ç–µ–≤–∞—è –∫–∞—Ä—Ç–∞ —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç –µ–≥–æ –≤ –æ–ø–µ—Ä–∞—Ç–∏–≤–Ω–æ–π –ø–∞–º—è—Ç–∏ –≤ –≤–∏–¥–µ —Å—Ç—Ä—É–∫—Ç—É—Ä—ã sk_buff –≤ –∫–æ–ª—å—Ü–µ–≤–æ–º –±—É—Ñ–µ—Ä–µ RX (–≤—Ö–æ–¥—è—â–µ–π) –æ—á–µ—Ä–µ–¥–∏.\n–ò —ç—Ç–æ –ø–µ—Ä–≤–∞—è –æ—Å—Ç–∞–Ω–æ–≤–∫–∞.\n–í –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç –º–æ–¥–µ–ª–∏ —Å–µ—Ç–µ–≤–æ–π –∫–∞—Ä—Ç—ã RX –æ—á–µ—Ä–µ–¥—å, –∫–∞–∫ –∏ –∏—Ö –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ, –º–æ–∂–µ–º –∫–æ–Ω—Ñ–∏–≥—É—Ä–∏—Ä–æ–≤–∞—Ç—å —á–µ—Ä–µ–∑ ethtool —É—Ç–∏–ª–∏—Ç—É:\nethtool -l # –ø–æ—Å–º–æ—Ç—Ä–µ—Ç—å —Ç–µ–∫—É—â–µ–µ –∏ –º–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –æ—á–µ—Ä–µ–¥–µ–π ethtool -L rx N # –∏–∑–º–µ–Ω–∏—Ç—å —Ç–µ–∫—É—â–µ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –æ—á–µ—Ä–µ–¥–µ–π ethtool -g # –ø–æ—Å–º–æ—Ç—Ä–µ—Ç—å —Ç–µ–∫—É—â–µ–µ –∏ –º–∞–∫—Å–∏–º–∞–ª—å–Ω—É—é –¥–ª–∏–Ω—É –æ—á–µ—Ä–µ–¥–∏ ethtool -G rx N # –∏–∑–º–µ–Ω–∏—Ç—å —Ç–µ–∫—É—â–∏–π —Ä–∞–∑–º–µ—Ä –æ—á–µ—Ä–µ–¥–∏ –ù–∞–¥–æ –∑–∞–º–µ—Ç–∏—Ç—å, —á—Ç–æ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–Ω—É—é –æ—á–µ—Ä–µ–¥—å –±—É–¥–µ—Ç –≤—ã—á–∏—â–∞—Ç—å –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–Ω—ã–π CPU, –ø–æ—Ç–æ–º—É –≤ –≤–∞–∫—É—É–º–µ –º–æ–∂–Ω–æ —Å–¥–µ–ª–∞—Ç—å –≤—ã–≤–æ–¥, —á—Ç–æ —á–µ–º –∏—Ö –æ—á–µ—Ä–µ–¥–µ–π –±–æ–ª—å—à–µ, —Ç–µ–º –±–æ–ª–µ–µ —Ä–∞–≤–Ω–æ–º–µ—Ä–Ω–æ —Ä–∞—Å–ø—Ä–µ–¥–µ–ª—è–µ—Ç—Å—è –Ω–∞–≥—Ä—É–∑–∫–∞ –Ω–∞ —Å–∏—Å—Ç–µ–º—É.\n–ù–æ –≤—Å–µ–≥–¥–∞ –µ—Å—Ç—å –Ω—é–∞–Ω—Å—ã, –æ –∫–æ—Ç–æ—Ä—ã—Ö –ø–æ–ª–µ–∑–Ω–æ –ø–æ–º–Ω–∏—Ç—å –∏ –ø—Ä–æ–≤–µ—Ä—è—Ç—å:\n–∞ –Ω–µ —Ö–æ—Ç–∏–º –ª–∏ –º—ã –æ—Å—Ç–∞–≤–ª—è—Ç—å –æ–±—Ä–∞–±–æ—Ç–∫—É —Ç—Ä–∞—Ñ–∏–∫–∞ —Å–ø–µ—Ü–∏–∞–ª—å–Ω–æ –≤—ã–¥–µ–ª–µ–Ω–Ω—ã–º –ø–æ–¥ —ç—Ç–æ CPU? –¢—Ä–∞—Ñ–∏–∫ –Ω–∞ –æ–¥–Ω–∏—Ö —è–¥—Ä–∞—Ö, —Å–µ—Ä–≤–∏—Å—ã –∂–∏–≤—É—Ç –Ω–∞ –¥—Ä—É–≥–∏—Ö‚Ä¶–º–µ–Ω—å—à–µ –ø—Ä–µ—Ä—ã–≤–∞–Ω–∏–π, –ø–æ–≤—ã—à–µ–Ω–∏–µ –ª–æ–∫–∞–ª—å–Ω–æ—Å—Ç–∏ –∫–µ—à–µ–π‚Ä¶ –∞ —á—Ç–æ –µ—Å–ª–∏ —É –Ω–∞—Å –ø–æ–ª–æ–≤–∏–Ω–∞ —è–¥–µ—Ä ‚Äú–Ω–µ—á–µ—Å—Ç–Ω—ã—Ö‚Äù (–≤–∫–ª—é—á–µ–Ω hyperthreading), –±—É–¥—É—Ç –ª–∏ 32 –æ—á–µ—Ä–µ–¥–∏ –Ω–∞ 16 –Ω–∞—Å—Ç–æ—è—â–∏—Ö —è–¥—Ä–∞—Ö (32 –≤–∏—Ä—Ç—É–∞–ª—å–Ω—ã—Ö) —Ä–∞–±–æ—Ç–∞—Ç—å –±—ã—Å—Ç—Ä–µ–µ –Ω–µ–∂–µ–ª–∏ –∫ –ø—Ä–∏–º–µ—Ä—É 8 –æ—á–µ—Ä–µ–¥–µ–π —Å —Ç–µ–º–∏ –∂–µ –≤–≤–æ–¥–Ω—ã–º–∏? –í–æ–æ–±—â–µ–º –µ—Å—Ç—å –æ —á–µ–º –ø–æ–¥—É–º–∞—Ç—å –∏ —á—Ç–æ –ø–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å.\n–ù–∞–±–ª—é–¥–∞—Ç—å –∑–∞ –ø–µ—Ä–µ–ø–æ–ª–Ω–µ–Ω–∏–µ–º –≤–æ–∑–º–æ–∂–Ω–æ —á–µ—Ä–µ–∑ —Ñ–∞–π–ª—ã:\n/sys/class/net//statistics/rx_dropped; /proc/net/dev. node_exporter –ª—é–±–µ–∑–Ω–æ —Å–æ–±–∏—Ä–∞–µ—Ç —ç—Ç–∏ –¥–∞–Ω–Ω—ã–µ —á–µ—Ä–µ–∑ –º–µ—Ç—Ä–∏–∫—É node_network_receive_drop_total , —á—Ç–æ –¥–æ—Å—Ç—É–ø–Ω–∞ –Ω–∞ —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–æ–º –¥–∞—à–±–æ—Ä–¥–µ Node Exporter Full.\nüí° –ï—â–µ –æ–¥–Ω–∞ –ø–æ–º–µ—Ç–∫–∞ - —è —Å–æ–∑–Ω–∞—Ç–µ–ª—å–Ω–æ –ø—Ä–æ–ø—É—Å–∫–∞—é –∏–∑ —Ä–∞—Å—Å–º–æ—Ç—Ä–µ–Ω–∏—è —Ç–∞–∫—É—é —à—Ç—É–∫—É –∫–∞–∫ Qdisc (queuing discipline), –Ω–∞–¥–µ—é—Å—å –≤–µ—Ä–Ω—É—Ç—å—Å—è –∫ –Ω–µ–π –≤ –±—É–¥—É—â–µ–º.\n–ü–æ—Å–ª–µ —Ç–æ–≥–æ –∫–∞–∫ —Å–∏—Å—Ç–µ–º—É —á–µ—Ä–µ–∑ –ø—Ä–µ—Ä—ã–≤–∞–Ω–∏—è (hard/soft) –∏–∑–≤–µ—Å—Ç–∏–ª–∏ –æ –Ω–∞–ª–∏—á–∏–∏ –ø–∞–∫–µ—Ç–∞, –∑–∞ —Ä–∞–±–æ—Ç—É –ø—Ä–∏–Ω–∏–º–∞–µ—Ç—Å—è —Ä—É—Ç–∏–Ω–∞ —è–¥—Ä–∞ softirqd - —Ä–∞–∑–≥—Ä–µ–±–∞—è RX –æ—á–µ—Ä–µ–¥—å.\n–ü–æ–¥–æ–±–Ω–æ –ª—é–±–æ–π –¥—Ä—É–≥–æ–π —Ä—É—Ç–∏–Ω–µ –µ–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ –Ω–∞ CPU –æ–ø—Ä–µ–¥–µ–ª—è–µ—Ç—Å—è linux scheduler –∏ –∫–∞–∫ —Å–ª–µ–¥—Å—Ç–≤–∏–µ –∫–æ–Ω–µ—á–Ω–æ –ø–æ –≤—Ä–µ–º–µ–Ω–∏. –ü—Ä–∏ –±–æ–ª—å—à–æ–º –æ–±—ä–µ–º–µ —Å–µ—Ç–µ–≤–æ–≥–æ —Ç—Ä–∞—Ñ–∏–∫–∞ –≤ —Ä–∞–º–∫–∞—Ö –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–≥–æ –ø–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏—è –Ω–∞ CPU softirqd –º–æ–∂–µ—Ç –Ω–µ —É—Å–ø–µ—Ç—å –æ–ø—É—Å—Ç–æ—à–∏—Ç—å –≤—Å—é RX –æ—á–µ—Ä–µ–¥—å, —á—Ç–æ —á—Ä–µ–≤–∞—Ç–æ —É–≤–µ–ª–∏—á–µ–Ω–∏—é latency. –í —Ç–∞–∫–∏—Ö —Å–ª—É—á–∞—è—Ö —Ä–∞—Å—Ç–µ—Ç —Å—á–µ—Ç—á–∏–∫ —Ç–∞–∫ –Ω–∞–∑—ã–≤–∞–µ–º—ã—Ö —Å–∫–≤–∏–∑–æ–≤ (squeezes).\n–ö —Å—á–∞—Å—Ç—å—é –µ—Å—Ç—å –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å –≤–ª–∏—è—Ç—å –Ω–∞ –ø–æ–≤–µ–¥–µ–Ω–∏–µ —Ä—É—Ç–∏–Ω—ã —á–µ—Ä–µ–∑ –Ω–∞—Å—Ç—Ä–æ–π–∫—É –±—é–¥–∂–µ—Ç–æ–≤. –†–∞–±–æ—Ç–∞ softirqd –≤ —Ä–∞–º–∫–∞—Ö –æ–¥–Ω–æ–≥–æ –ø–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏—è –∑–∞–≤–µ—Ä—à–∏—Ç—Å—è –ª–∏–±–æ –∫–æ–≥–¥–∞ –∏—Å—Ç–µ—á–µ—Ç net.core.netdev_budget_usecs –ª–∏–±–æ —á–∏—Å–ª–æ –æ–±—Ä–∞–±–æ—Ç–∞–Ω–Ω—ã—Ö –ø–∞–∫–µ—Ç–æ–≤ —Å—Ç–∞–Ω–µ—Ç —Ä–∞–≤–Ω—ã–º net.core.netdev_budget.\n–î–ª—è –Ω–∞–±–ª—é–¥–µ–Ω–∏—è –∑–∞ —Ä–∞–±–æ—Ç–æ–π softirqd –≤–æ–∑–º–æ–∂–Ω–æ —á–µ—Ä–µ–∑ —Ñ–∞–π–ª /proc/net/softnet_stat –ª–∏–±–æ —Å –ø–æ–º–æ—â—å—é –º–µ—Ç—Ä–∏–∫:\nnode_softnet_processed_total node_softnet_times_squeezed_total –ö–∞–∫ –±—ã–ª–æ —É–∫–∞–∑–∞–Ω–Ω–æ –≤ –Ω–∞—á–∞–ª–µ –∑–∞–º–µ—Ç–∫–∏ —Å–µ—Ç–µ–≤–æ–π –ø–∞–∫–µ—Ç –ø—Ä–µ–¥–Ω–∞–∑–Ω–∞—á–µ—Ç—Å—è –≤–∏—Ä—Ç—É–∞–ª—å–Ω–æ–π –º–∞—à–∏–Ω–µ, –∞ –∑–Ω–∞—á–∏—Ç –≤ –∏—Ç–æ–≥–µ –ø–æ—Å–ª–µ –æ–±—Ä–∞–±–æ—Ç–∫–∏ –Ω–∞ —É—Ä–æ–≤–Ω–µ –≥–∏–ø–µ—Ä–≤–∏–∑–æ—Ä–∞ –æ–Ω –ø–æ–ø–∞–¥–∞–µ—Ç –≤ –æ—á–µ—Ä–µ–¥—å tap-–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞ txqueue.\ntap-–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å - —ç—Ç–æ —Ç–æ—Ç, –∫–æ—Ç–æ—Ä—ã–π –æ–¥–Ω–æ–π —Å—Ç–æ—Ä–æ–Ω–æ–π —Å–º–æ—Ç—Ä–∏—Ç –Ω–∞ —Ö–æ—Å—Ç–æ–≤—É—é –º–∞—à–∏–Ω—É, –∞ –¥—Ä—É–≥–æ–π –≤ –≤–∏—Ä—Ç—É–∞–ª—å–Ω—É—é. –ü–æ–¥—Ä–æ–±–Ω–µ–µ –ø—Ä–æ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—é —á–∏—Ç–∞–π –≤ –±–ª–æ–≥–µ cloudflare.\n–£–∑–Ω–∞—Ç—å –¥–ª–∏–Ω—É –æ—á–µ—Ä–µ–¥–∏ (qlen) –º–æ–∂–Ω–æ –∫–æ–º–∞–Ω–¥–æ–π:\nip a | grep tap69035i0 43: tap30035i0: mtu 1500 qdisc pfifo_fast master fwbr30035i0 state UNKNOWN group default qlen 1000 –≥–¥–µ tap69035i0 –∏–º—è –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞ –í–ú —Å —Ç–æ—á–∫–∏ –∑—Ä–µ–Ω–∏—è –≥–∏–ø–µ—Ä–≤–∏–∑–æ—Ä–∞, –≤ proxmox –∑–∞–¥–∞–µ—Ç—Å—è –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–º ifname.\n–í –Ω–∞—à–µ–º —Å–ª—É—á–∞–µ qlen —Ä–∞–≤–Ω–∞ 1000.\n–ò–Ω—Ç–µ—Ä–µ—Å–Ω–æ, —á—Ç–æ –æ—á–µ—Ä–µ–¥—å –Ω–∞–∑—ã–≤–∞–µ—Ç—Å—è txqueue, —Ç–æ –µ—Å—Ç—å –∏—Å—Ö–æ–¥—è—â–∞—è, —Ç–∞–∫ –∫–∞–∫ —Å —Ç–æ—á–∫–∏ –∑—Ä–µ–Ω–∏—è –≥–∏–ø–µ—Ä–≤–∏–∑–æ—Ä–∞ –ø–∞–∫–µ—Ç –ø–æ–∫–∏–¥–∞–µ—Ç –•–æ—Å—Ç, –Ω–∞–ø—Ä–∞–≤–ª—è—è—Å—å –¥–∞–ª—å—à–µ –∫ –í–∏—Ä—Ç—É–∞–ª—å–Ω–æ–π –º–∞—à–∏–Ω–µ. –≠—Ç–æ –º–æ–∂–µ—Ç –≤–≤–æ–¥–∏—Ç—å –≤ –∑–∞–±–ª—É–∂–¥–µ–Ω–∏–µ.\n–°–ª–µ–¥–∏—Ç—å –∑–∞ –ø–µ—Ä–µ–ø–æ–ª–Ω–µ–Ω–∏–µ–º –Ω–∞ —Ö–æ—Å—Ç–æ–≤–æ–π –º–∞—à–∏–Ω–µ –ø–æ–º–æ–≥–∞–µ—Ç —Ñ–∞–π–ª–∏–∫–∏:\n/sys/class/net//statistics/tx_dropped; /proc/net/dev. node_exporter –æ—Ç—Å–ª–µ–∂–∏–≤–∞–µ—Ç —ç—Ç–∏ —Å–æ–±—ã—Ç–∏—è —á–µ—Ä–µ–∑ node_network_transmit_drop_total.\n–ò–∑–º–µ–Ω—è–µ—Ç—Å—è —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ —á–µ—Ä–µ–∑\nip link set dev* txqueuelen N –°—Ç–æ–∏—Ç –æ—Ç–º–µ—Ç–∏—Ç—å, —á—Ç–æ –ø–µ—Ä–µ–ø–æ–ª–Ω–µ–Ω–∏–µ txqueue tap/tun –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞ —á–∞—Å—Ç–æ —É–ø—É—Å–∫–∞–µ—Ç—Å—è –∏–∑ —Ä–∞—Å—Å–º–æ—Ç—Ä–µ–Ω–∏—è, —Ç–∞–∫ –∫–∞–∫ –º–µ—Ç—Ä–∏–∫–∞ –ø—Ä–∏–Ω–∞–¥–ª–µ–∂–∏—Ç –≥–∏–ø–µ—Ä–≤–∏–∑–æ—Ä—É, —á—Ç–æ –ø–æ–ª–Ω–æ—Å—Ç—å—é —Å–∫—Ä—ã—Ç–æ –æ—Ç —É—Ä–æ–≤–Ω—è –≤–∏—Ä—Ç—É–∞–ª—å–Ω–æ–π –º–∞—à–∏–Ω—ã. –ü–æ—Å—Ç–∞—Ä–∞–µ–º—Å—è —Ä–µ—à–∏—Ç—å —ç—Ç—É –ø—Ä–æ–±–ª–µ–º—É –¥–∞–ª–µ–µ.\n–ù–∞–∫–æ–Ω–µ—Ü –ø–∞–∫–µ—Ç –≥–æ—Ç–æ–≤ –ø–æ–¥–Ω—è—Ç—å—Å—è –Ω–∞ —É—Ä–æ–≤–µ–Ω—å –≤–∏—Ä—Ç—É–∞–ª—å–Ω–æ–π –º–∞—à–∏–Ω—ã. –†–∞—Å—Å–º–æ—Ç—Ä–∏–º –µ–≥–æ –≤ —Å–ª–µ–¥—É—é—â–µ–π –∑–∞–º–µ—Ç–∫–µ.\n–£–¥–∞—á–∏!\n","wordCount":"679","inLanguage":"en","datePublished":"2024-04-21T00:00:00Z","dateModified":"2024-04-21T00:00:00Z","mainEntityOfPage":{"@type":"WebPage","@id":"https://alebsys.github.io/posts/long-way-to-the-app-1/"},"publisher":{"@type":"Organization","name":"Performance Matters","logo":{"@type":"ImageObject","url":"https://alebsys.github.io/images/favicon.ico"}}}</script></head><body id=top><script>localStorage.getItem("pref-theme")==="dark"?document.body.classList.add("dark"):localStorage.getItem("pref-theme")==="light"?document.body.classList.remove("dark"):window.matchMedia("(prefers-color-scheme: dark)").matches&&document.body.classList.add("dark")</script><header class=header><nav class=nav><div class=logo><a href=https://alebsys.github.io/ accesskey=h title="Performance matters! (Alt + H)"><img src=https://alebsys.github.io/images/favicon.ico alt aria-label=logo height=35>Performance matters!</a><div class=logo-switches><button id=theme-toggle accesskey=t title="(Alt + T)"><svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg><svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button></div></div><ul id=menu><li><a href=https://alebsys.github.io/about/ title=About><span>About</span></a></li><li><a href=https://alebsys.github.io/posts/ title=Blog><span>Blog</span></a></li><li><a href=https://alebsys.github.io/for_hr/ title="For HR"><span>For HR</span></a></li><li><a href=https://alebsys.github.io/mentoring/ title=Mentoring><span>Mentoring</span></a></li></ul></nav></header><main class=main><article class=post-single><header class=post-header><div class=breadcrumbs><a href=https://alebsys.github.io/>Home</a>&nbsp;¬ª&nbsp;<a href=https://alebsys.github.io/posts/>Posts</a></div><h1 class="post-title entry-hint-parent">Long way to the application, ‚Ññ1.</h1><div class=post-meta><span title='2024-04-21 00:00:00 +0000 UTC'>April 21, 2024</span>&nbsp;¬∑&nbsp;4 min</div></header><div class=post-content><p>UPD:</p><ul><li>14.05.24 - –¥–æ–±–∞–≤–∏–ª –±–ª–æ–∫-—Å—Ö–µ–º—É –¥–≤–∏–∂–µ–Ω–∏—è –ø–∞–∫–µ—Ç–∞ –ø–æ –æ—á–µ—Ä–µ–¥—è–º;</li><li>01.05.24 - –æ–±–Ω–æ–≤–∏–ª –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –ø–æ –¥–µ—è—Ç–µ–ª—å–Ω–æ—Å—Ç–∏ <code>softirqd</code>.</li></ul><hr><p>–ü—Ä–µ–∂–¥–µ —á–µ–º —Å–µ—Ç–µ–≤–æ–π –ø–∞–∫–µ—Ç –∏–∑ —Å–µ—Ä–≤–∏—Å–∞ –ê –ø–æ–ø–∞–¥–µ—Ç –≤ —Å–µ—Ä–≤–∏—Å –ë, –µ–º—É —Å–ª–µ–¥—É–µ—Ç –º–∏–Ω–æ–≤–∞—Ç—å –º–Ω–æ–∂–µ—Å—Ç–≤–æ —Å–∏—Å—Ç–µ–º –ø–æ —Å–µ—Ä–µ–¥–∏–Ω–µ, –≥–¥–µ –æ–Ω —Å–¥–µ–ª–∞–µ—Ç –Ω–∏ –æ–¥–Ω—É –æ—Å—Ç–∞–Ω–æ–≤–∫—É.</p><p>–ò, —á—Ç–æ —Å–∞–º–æ–µ –∏–Ω—Ç–µ—Ä–µ—Å–Ω–æ–µ, –Ω–∏–∫—Ç–æ (–∏–ª–∏ –Ω–∏—á—Ç–æ) –Ω–µ –≥–∞—Ä–∞–Ω—Ç–∏—Ä—É–µ–º –µ–º—É —É—Å–ø–µ—Ö –≤ –∫–æ–Ω–µ—á–Ω–æ —Å—á–µ—Ç–µ.</p><p>–û–ø–∏—Å–∞—Ç—å –ø–æ–ª–Ω—ã–π –ø—É—Ç—å –º–Ω–µ –Ω–µ —Ö–≤–∞—Ç–∏—Ç –Ω–∏ –∑–Ω–∞–Ω–∏–π, –Ω–∏ —Ç–µ—Ä–ø–µ–Ω–∏—è, –ø–æ—ç—Ç–æ–º—É —Å–æ—Å—Ä–µ–¥–æ—Ç–æ—á—É—Å—å —Ç–æ–ª—å–∫–æ –Ω–∞ –∫–æ–Ω–µ—á–Ω–æ–π —á–∞—Å—Ç–∏ –º–∞—Ä—à—Ä—É—Ç–∞ - –ø–∞–∫–µ—Ç –ø—Ä–∏–±—ã–ª –Ω–∞ —Ü–µ–ª–µ–≤–æ–π –•–æ—Å—Ç, –≥–¥–µ –∂–∏–≤–µ—Ç —Å–µ—Ä–≤–∏—Å –ë.</p><p>–¶–µ–ª–∏ –∑–∞–º–µ—Ç–∫–∏:</p><ol><li>–ø–æ–∫–∞–∑–∞—Ç—å —á–µ—Ä–µ–∑ –∫–∞–∫–∏–µ –æ—Å—Ç–∞–Ω–æ–≤–∫–∏, —Å—á–∏—Ç–∞–π –æ—á–µ—Ä–µ–¥–∏, –ø—Ä–æ—Ö–æ–¥–∏—Ç —Å–µ—Ç–µ–≤–æ–π –ø–∞–∫–µ—Ç –ø—Ä–µ–∂–¥–µ —á–µ–º –¥–æ—Å—Ç–∏–≥–Ω–µ—Ç –ø–æ–ª—É—á–∞—Ç–µ–ª—è;</li><li>–∫–∞–∫ –º—ã –º–æ–∂–µ–º —ç—Ç–∏ –æ—á–µ—Ä–µ–¥–∏ –º–æ–Ω–∏—Ç–æ—Ä–∏—Ç—å –∏ –∫–∞–∫ –Ω–∞ –Ω–∏—Ö –≤–ª–∏—è—Ç—å.</li></ol><p>–í–≤–æ–¥–Ω—ã–µ - –æ–±—â–µ–Ω–∏–µ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç –ø–æ TCP –ø—Ä–æ—Ç–æ–∫–æ–ª—É, –≥–¥–µ –∫–æ–Ω–µ—á–Ω—ã–π –•–æ—Å—Ç —Ä–∞–±–æ—Ç–∞–µ—Ç –ø–æ–¥ Linux. –ò –ø—É—Å—Ç—å —ç—Ç–æ –±—É–¥–µ—Ç –≤–∏—Ä—Ç—É–∞–ª—å–Ω–∞—è –º–∞—à–∏–Ω–∞.</p><hr><p><img loading=lazy src=/images/long-way-to-the-app2.png alt="network packet path"></p><h3 id=–∏-—Ç–∞–∫-–ø–∞–∫–µ—Ç-–ø—Ä–∏–±—ã–ª-–Ω–∞-—Ö–æ—Å—Ç>–ò —Ç–∞–∫, –ø–∞–∫–µ—Ç –ø—Ä–∏–±—ã–ª –Ω–∞ –•–æ—Å—Ç‚Ä¶<a hidden class=anchor aria-hidden=true href=#–∏-—Ç–∞–∫-–ø–∞–∫–µ—Ç-–ø—Ä–∏–±—ã–ª-–Ω–∞-—Ö–æ—Å—Ç>#</a></h3><p>–ü–µ—Ä–≤—ã–º –¥–µ–ª–æ–º –æ–Ω –ø–æ–ø–∞–¥–∞–µ—Ç –≤ —Å–µ—Ç–µ–≤—É—é –∫–∞—Ä—Ç—É (<strong>NIC</strong>). –ß–µ—Ä–µ–∑ <strong>DMA</strong> —Å–µ—Ç–µ–≤–∞—è –∫–∞—Ä—Ç–∞ —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç –µ–≥–æ –≤ –æ–ø–µ—Ä–∞—Ç–∏–≤–Ω–æ–π –ø–∞–º—è—Ç–∏ –≤ –≤–∏–¥–µ —Å—Ç—Ä—É–∫—Ç—É—Ä—ã <a href=https://elixir.bootlin.com/linux/latest/source/include/linux/skbuff.h#L850>sk_buff</a> –≤ –∫–æ–ª—å—Ü–µ–≤–æ–º –±—É—Ñ–µ—Ä–µ <code>RX</code> (–≤—Ö–æ–¥—è—â–µ–π) –æ—á–µ—Ä–µ–¥–∏.</p><p>–ò —ç—Ç–æ <strong>–ø–µ—Ä–≤–∞—è</strong> <strong>–æ—Å—Ç–∞–Ω–æ–≤–∫–∞</strong>.</p><p>–í –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç –º–æ–¥–µ–ª–∏ —Å–µ—Ç–µ–≤–æ–π –∫–∞—Ä—Ç—ã <code>RX</code> –æ—á–µ—Ä–µ–¥—å, –∫–∞–∫ –∏ –∏—Ö –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ, –º–æ–∂–µ–º –∫–æ–Ω—Ñ–∏–≥—É—Ä–∏—Ä–æ–≤–∞—Ç—å —á–µ—Ä–µ–∑ <code>ethtool</code> —É—Ç–∏–ª–∏—Ç—É:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>ethtool -l &lt;interface name&gt; <span class=c1># –ø–æ—Å–º–æ—Ç—Ä–µ—Ç—å —Ç–µ–∫—É—â–µ–µ –∏ –º–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –æ—á–µ—Ä–µ–¥–µ–π</span>
</span></span><span class=line><span class=cl>ethtool -L &lt;interface name&gt; rx N <span class=c1># –∏–∑–º–µ–Ω–∏—Ç—å —Ç–µ–∫—É—â–µ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –æ—á–µ—Ä–µ–¥–µ–π</span>
</span></span><span class=line><span class=cl>ethtool -g &lt;interface name&gt; <span class=c1># –ø–æ—Å–º–æ—Ç—Ä–µ—Ç—å —Ç–µ–∫—É—â–µ–µ –∏ –º–∞–∫—Å–∏–º–∞–ª—å–Ω—É—é –¥–ª–∏–Ω—É –æ—á–µ—Ä–µ–¥–∏</span>
</span></span><span class=line><span class=cl>ethtool -G &lt;interface name&gt; rx N <span class=c1># –∏–∑–º–µ–Ω–∏—Ç—å —Ç–µ–∫—É—â–∏–π —Ä–∞–∑–º–µ—Ä –æ—á–µ—Ä–µ–¥–∏</span>
</span></span></code></pre></div><p>–ù–∞–¥–æ –∑–∞–º–µ—Ç–∏—Ç—å, —á—Ç–æ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–Ω—É—é –æ—á–µ—Ä–µ–¥—å –±—É–¥–µ—Ç –≤—ã—á–∏—â–∞—Ç—å –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–Ω—ã–π CPU, –ø–æ—Ç–æ–º—É –≤ –≤–∞–∫—É—É–º–µ –º–æ–∂–Ω–æ —Å–¥–µ–ª–∞—Ç—å –≤—ã–≤–æ–¥, —á—Ç–æ —á–µ–º –∏—Ö –æ—á–µ—Ä–µ–¥–µ–π –±–æ–ª—å—à–µ, —Ç–µ–º –±–æ–ª–µ–µ —Ä–∞–≤–Ω–æ–º–µ—Ä–Ω–æ —Ä–∞—Å–ø—Ä–µ–¥–µ–ª—è–µ—Ç—Å—è –Ω–∞–≥—Ä—É–∑–∫–∞ –Ω–∞ —Å–∏—Å—Ç–µ–º—É.</p><p>–ù–æ –≤—Å–µ–≥–¥–∞ –µ—Å—Ç—å –Ω—é–∞–Ω—Å—ã, –æ –∫–æ—Ç–æ—Ä—ã—Ö –ø–æ–ª–µ–∑–Ω–æ –ø–æ–º–Ω–∏—Ç—å –∏ –ø—Ä–æ–≤–µ—Ä—è—Ç—å:</p><ul><li>–∞ –Ω–µ —Ö–æ—Ç–∏–º –ª–∏ –º—ã –æ—Å—Ç–∞–≤–ª—è—Ç—å –æ–±—Ä–∞–±–æ—Ç–∫—É —Ç—Ä–∞—Ñ–∏–∫–∞ —Å–ø–µ—Ü–∏–∞–ª—å–Ω–æ –≤—ã–¥–µ–ª–µ–Ω–Ω—ã–º –ø–æ–¥ —ç—Ç–æ CPU? –¢—Ä–∞—Ñ–∏–∫ –Ω–∞ –æ–¥–Ω–∏—Ö —è–¥—Ä–∞—Ö, —Å–µ—Ä–≤–∏—Å—ã –∂–∏–≤—É—Ç –Ω–∞ –¥—Ä—É–≥–∏—Ö‚Ä¶–º–µ–Ω—å—à–µ –ø—Ä–µ—Ä—ã–≤–∞–Ω–∏–π, –ø–æ–≤—ã—à–µ–Ω–∏–µ –ª–æ–∫–∞–ª—å–Ω–æ—Å—Ç–∏ –∫–µ—à–µ–π‚Ä¶</li><li>–∞ —á—Ç–æ –µ—Å–ª–∏ —É –Ω–∞—Å –ø–æ–ª–æ–≤–∏–Ω–∞ —è–¥–µ—Ä ‚Äú–Ω–µ—á–µ—Å—Ç–Ω—ã—Ö‚Äù (–≤–∫–ª—é—á–µ–Ω hyperthreading), –±—É–¥—É—Ç –ª–∏ 32 –æ—á–µ—Ä–µ–¥–∏ –Ω–∞ 16 –Ω–∞—Å—Ç–æ—è—â–∏—Ö —è–¥—Ä–∞—Ö (32 –≤–∏—Ä—Ç—É–∞–ª—å–Ω—ã—Ö) —Ä–∞–±–æ—Ç–∞—Ç—å –±—ã—Å—Ç—Ä–µ–µ –Ω–µ–∂–µ–ª–∏ –∫ –ø—Ä–∏–º–µ—Ä—É 8 –æ—á–µ—Ä–µ–¥–µ–π —Å —Ç–µ–º–∏ –∂–µ –≤–≤–æ–¥–Ω—ã–º–∏?</li></ul><p>–í–æ–æ–±—â–µ–º –µ—Å—Ç—å –æ —á–µ–º –ø–æ–¥—É–º–∞—Ç—å –∏ —á—Ç–æ –ø–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å.</p><p>–ù–∞–±–ª—é–¥–∞—Ç—å –∑–∞ –ø–µ—Ä–µ–ø–æ–ª–Ω–µ–Ω–∏–µ–º –≤–æ–∑–º–æ–∂–Ω–æ —á–µ—Ä–µ–∑ —Ñ–∞–π–ª—ã:</p><ul><li><code>/sys/class/net/&lt;interface name>/statistics/rx_dropped</code>;</li><li><code>/proc/net/dev</code>.</li></ul><p><strong>node_exporter</strong> –ª—é–±–µ–∑–Ω–æ —Å–æ–±–∏—Ä–∞–µ—Ç —ç—Ç–∏ –¥–∞–Ω–Ω—ã–µ —á–µ—Ä–µ–∑ –º–µ—Ç—Ä–∏–∫—É <code>node_network_receive_drop_total</code> , —á—Ç–æ –¥–æ—Å—Ç—É–ø–Ω–∞ –Ω–∞ —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–æ–º –¥–∞—à–±–æ—Ä–¥–µ <a href=https://grafana.com/grafana/dashboards/1860-node-exporter-full/>Node Exporter Full</a>.</p><p>üí° –ï—â–µ –æ–¥–Ω–∞ –ø–æ–º–µ—Ç–∫–∞ - —è —Å–æ–∑–Ω–∞—Ç–µ–ª—å–Ω–æ –ø—Ä–æ–ø—É—Å–∫–∞—é –∏–∑ —Ä–∞—Å—Å–º–æ—Ç—Ä–µ–Ω–∏—è —Ç–∞–∫—É—é —à—Ç—É–∫—É –∫–∞–∫ <strong>Qdisc</strong> (queuing discipline), –Ω–∞–¥–µ—é—Å—å –≤–µ—Ä–Ω—É—Ç—å—Å—è –∫ –Ω–µ–π –≤ –±—É–¥—É—â–µ–º.</p><p>–ü–æ—Å–ª–µ —Ç–æ–≥–æ –∫–∞–∫ —Å–∏—Å—Ç–µ–º—É —á–µ—Ä–µ–∑ –ø—Ä–µ—Ä—ã–≤–∞–Ω–∏—è (hard/soft) –∏–∑–≤–µ—Å—Ç–∏–ª–∏ –æ –Ω–∞–ª–∏—á–∏–∏ –ø–∞–∫–µ—Ç–∞, –∑–∞ —Ä–∞–±–æ—Ç—É –ø—Ä–∏–Ω–∏–º–∞–µ—Ç—Å—è —Ä—É—Ç–∏–Ω–∞ —è–¥—Ä–∞ <code>softirqd</code> - —Ä–∞–∑–≥—Ä–µ–±–∞—è <code>RX</code> –æ—á–µ—Ä–µ–¥—å.</p><p>–ü–æ–¥–æ–±–Ω–æ –ª—é–±–æ–π –¥—Ä—É–≥–æ–π —Ä—É—Ç–∏–Ω–µ –µ–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ –Ω–∞ CPU –æ–ø—Ä–µ–¥–µ–ª—è–µ—Ç—Å—è linux scheduler –∏ –∫–∞–∫ —Å–ª–µ–¥—Å—Ç–≤–∏–µ –∫–æ–Ω–µ—á–Ω–æ –ø–æ –≤—Ä–µ–º–µ–Ω–∏.
–ü—Ä–∏ –±–æ–ª—å—à–æ–º –æ–±—ä–µ–º–µ —Å–µ—Ç–µ–≤–æ–≥–æ —Ç—Ä–∞—Ñ–∏–∫–∞ –≤ —Ä–∞–º–∫–∞—Ö –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–≥–æ –ø–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏—è –Ω–∞ CPU <code>softirqd</code> –º–æ–∂–µ—Ç –Ω–µ —É—Å–ø–µ—Ç—å –æ–ø—É—Å—Ç–æ—à–∏—Ç—å –≤—Å—é RX –æ—á–µ—Ä–µ–¥—å, —á—Ç–æ —á—Ä–µ–≤–∞—Ç–æ —É–≤–µ–ª–∏—á–µ–Ω–∏—é latency. –í —Ç–∞–∫–∏—Ö —Å–ª—É—á–∞—è—Ö —Ä–∞—Å—Ç–µ—Ç —Å—á–µ—Ç—á–∏–∫ —Ç–∞–∫ –Ω–∞–∑—ã–≤–∞–µ–º—ã—Ö —Å–∫–≤–∏–∑–æ–≤ (squeezes).</p><p>–ö —Å—á–∞—Å—Ç—å—é –µ—Å—Ç—å –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å –≤–ª–∏—è—Ç—å –Ω–∞ –ø–æ–≤–µ–¥–µ–Ω–∏–µ —Ä—É—Ç–∏–Ω—ã —á–µ—Ä–µ–∑ –Ω–∞—Å—Ç—Ä–æ–π–∫—É –±—é–¥–∂–µ—Ç–æ–≤. –†–∞–±–æ—Ç–∞ <code>softirqd</code> –≤ —Ä–∞–º–∫–∞—Ö –æ–¥–Ω–æ–≥–æ –ø–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏—è –∑–∞–≤–µ—Ä—à–∏—Ç—Å—è –ª–∏–±–æ –∫–æ–≥–¥–∞ –∏—Å—Ç–µ—á–µ—Ç <code>net.core.netdev_budget_usecs</code> –ª–∏–±–æ —á–∏—Å–ª–æ –æ–±—Ä–∞–±–æ—Ç–∞–Ω–Ω—ã—Ö –ø–∞–∫–µ—Ç–æ–≤ —Å—Ç–∞–Ω–µ—Ç —Ä–∞–≤–Ω—ã–º <code>net.core.netdev_budget</code>.</p><p>–î–ª—è –Ω–∞–±–ª—é–¥–µ–Ω–∏—è –∑–∞ —Ä–∞–±–æ—Ç–æ–π <code>softirqd</code> –≤–æ–∑–º–æ–∂–Ω–æ —á–µ—Ä–µ–∑ —Ñ–∞–π–ª <code>/proc/net/softnet_stat</code> –ª–∏–±–æ —Å –ø–æ–º–æ—â—å—é –º–µ—Ç—Ä–∏–∫:</p><ul><li><code>node_softnet_processed_total</code></li><li><code>node_softnet_times_squeezed_total</code></li></ul><p>–ö–∞–∫ –±—ã–ª–æ —É–∫–∞–∑–∞–Ω–Ω–æ –≤ –Ω–∞—á–∞–ª–µ –∑–∞–º–µ—Ç–∫–∏ —Å–µ—Ç–µ–≤–æ–π –ø–∞–∫–µ—Ç –ø—Ä–µ–¥–Ω–∞–∑–Ω–∞—á–µ—Ç—Å—è –≤–∏—Ä—Ç—É–∞–ª—å–Ω–æ–π –º–∞—à–∏–Ω–µ, –∞ –∑–Ω–∞—á–∏—Ç –≤ –∏—Ç–æ–≥–µ –ø–æ—Å–ª–µ –æ–±—Ä–∞–±–æ—Ç–∫–∏ –Ω–∞ —É—Ä–æ–≤–Ω–µ –≥–∏–ø–µ—Ä–≤–∏–∑–æ—Ä–∞ –æ–Ω –ø–æ–ø–∞–¥–∞–µ—Ç –≤ –æ—á–µ—Ä–µ–¥—å <code>tap</code>-–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞ <code>txqueue</code>.</p><p><code>tap</code>-–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å - —ç—Ç–æ —Ç–æ—Ç, –∫–æ—Ç–æ—Ä—ã–π –æ–¥–Ω–æ–π —Å—Ç–æ—Ä–æ–Ω–æ–π —Å–º–æ—Ç—Ä–∏—Ç –Ω–∞ —Ö–æ—Å—Ç–æ–≤—É—é –º–∞—à–∏–Ω—É, –∞ –¥—Ä—É–≥–æ–π –≤ –≤–∏—Ä—Ç—É–∞–ª—å–Ω—É—é.
–ü–æ–¥—Ä–æ–±–Ω–µ–µ –ø—Ä–æ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—é —á–∏—Ç–∞–π –≤ <a href=https://blog.cloudflare.com/virtual-networking-101-understanding-tap>–±–ª–æ–≥–µ</a> cloudflare.</p><p>–£–∑–Ω–∞—Ç—å –¥–ª–∏–Ω—É –æ—á–µ—Ä–µ–¥–∏ (<code>qlen</code>) –º–æ–∂–Ω–æ –∫–æ–º–∞–Ω–¥–æ–π:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>ip a <span class=p>|</span> grep tap69035i0
</span></span><span class=line><span class=cl>43: tap30035i0: &lt;BROADCAST,MULTICAST,PROMISC,UP,LOWER_UP&gt; mtu <span class=m>1500</span> qdisc pfifo_fast master fwbr30035i0 state UNKNOWN group default qlen <span class=m>1000</span>
</span></span></code></pre></div><p>–≥–¥–µ <code>tap69035i0</code> –∏–º—è –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞ –í–ú —Å —Ç–æ—á–∫–∏ –∑—Ä–µ–Ω–∏—è –≥–∏–ø–µ—Ä–≤–∏–∑–æ—Ä–∞, –≤ <strong>proxmox</strong> –∑–∞–¥–∞–µ—Ç—Å—è –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–º <code>ifname</code>.</p><p>–í –Ω–∞—à–µ–º —Å–ª—É—á–∞–µ <code>qlen</code> —Ä–∞–≤–Ω–∞ 1000.</p><p>–ò–Ω—Ç–µ—Ä–µ—Å–Ω–æ, —á—Ç–æ –æ—á–µ—Ä–µ–¥—å –Ω–∞–∑—ã–≤–∞–µ—Ç—Å—è <code>txqueue</code>, —Ç–æ –µ—Å—Ç—å –∏—Å—Ö–æ–¥—è—â–∞—è, —Ç–∞–∫ –∫–∞–∫ —Å —Ç–æ—á–∫–∏ –∑—Ä–µ–Ω–∏—è –≥–∏–ø–µ—Ä–≤–∏–∑–æ—Ä–∞ –ø–∞–∫–µ—Ç –ø–æ–∫–∏–¥–∞–µ—Ç –•–æ—Å—Ç, –Ω–∞–ø—Ä–∞–≤–ª—è—è—Å—å –¥–∞–ª—å—à–µ –∫ –í–∏—Ä—Ç—É–∞–ª—å–Ω–æ–π –º–∞—à–∏–Ω–µ. –≠—Ç–æ –º–æ–∂–µ—Ç –≤–≤–æ–¥–∏—Ç—å –≤ –∑–∞–±–ª—É–∂–¥–µ–Ω–∏–µ.</p><p>–°–ª–µ–¥–∏—Ç—å –∑–∞ –ø–µ—Ä–µ–ø–æ–ª–Ω–µ–Ω–∏–µ–º –Ω–∞ —Ö–æ—Å—Ç–æ–≤–æ–π –º–∞—à–∏–Ω–µ –ø–æ–º–æ–≥–∞–µ—Ç —Ñ–∞–π–ª–∏–∫–∏:</p><ul><li><code>/sys/class/net/&lt;interface name>/statistics/tx_dropped</code>;</li><li><code>/proc/net/dev</code>.</li></ul><p><strong>node_exporter</strong> –æ—Ç—Å–ª–µ–∂–∏–≤–∞–µ—Ç —ç—Ç–∏ —Å–æ–±—ã—Ç–∏—è —á–µ—Ä–µ–∑ <code>node_network_transmit_drop_total</code>.</p><p>–ò–∑–º–µ–Ω—è–µ—Ç—Å—è —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ —á–µ—Ä–µ–∑</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>ip link <span class=nb>set</span> dev* &lt;interface name&gt; txqueuelen N
</span></span></code></pre></div><p>–°—Ç–æ–∏—Ç –æ—Ç–º–µ—Ç–∏—Ç—å, —á—Ç–æ –ø–µ—Ä–µ–ø–æ–ª–Ω–µ–Ω–∏–µ <code>txqueue</code> <code>tap/tun</code> –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞ —á–∞—Å—Ç–æ —É–ø—É—Å–∫–∞–µ—Ç—Å—è –∏–∑ —Ä–∞—Å—Å–º–æ—Ç—Ä–µ–Ω–∏—è, —Ç–∞–∫ –∫–∞–∫ –º–µ—Ç—Ä–∏–∫–∞ –ø—Ä–∏–Ω–∞–¥–ª–µ–∂–∏—Ç –≥–∏–ø–µ—Ä–≤–∏–∑–æ—Ä—É, —á—Ç–æ –ø–æ–ª–Ω–æ—Å—Ç—å—é —Å–∫—Ä—ã—Ç–æ –æ—Ç —É—Ä–æ–≤–Ω—è –≤–∏—Ä—Ç—É–∞–ª—å–Ω–æ–π –º–∞—à–∏–Ω—ã. –ü–æ—Å—Ç–∞—Ä–∞–µ–º—Å—è —Ä–µ—à–∏—Ç—å —ç—Ç—É –ø—Ä–æ–±–ª–µ–º—É –¥–∞–ª–µ–µ.</p><p>–ù–∞–∫–æ–Ω–µ—Ü –ø–∞–∫–µ—Ç –≥–æ—Ç–æ–≤ –ø–æ–¥–Ω—è—Ç—å—Å—è –Ω–∞ —É—Ä–æ–≤–µ–Ω—å –≤–∏—Ä—Ç—É–∞–ª—å–Ω–æ–π –º–∞—à–∏–Ω—ã. –†–∞—Å—Å–º–æ—Ç—Ä–∏–º –µ–≥–æ –≤ —Å–ª–µ–¥—É—é—â–µ–π –∑–∞–º–µ—Ç–∫–µ.</p><p>–£–¥–∞—á–∏!</p></div><footer class=post-footer><ul class=post-tags><li><a href=https://alebsys.github.io/tags/network/>Network</a></li><li><a href=https://alebsys.github.io/tags/linux/>Linux</a></li><li><a href=https://alebsys.github.io/tags/virtualization/>Virtualization</a></li><li><a href=https://alebsys.github.io/tags/tcp/>Tcp</a></li><li><a href=https://alebsys.github.io/tags/tuning/>Tuning</a></li></ul></footer><div id=disqus_thread></div><script>window.disqus_config=function(){},function(){if(["localhost","127.0.0.1"].indexOf(window.location.hostname)!=-1){document.getElementById("disqus_thread").innerHTML="Disqus comments not available by default when the website is previewed locally.";return}var t=document,e=t.createElement("script");e.async=!0,e.src="//https-alebsys-github-io.disqus.com/embed.js",e.setAttribute("data-timestamp",+new Date),(t.head||t.body).appendChild(e)}()</script><noscript>Please enable JavaScript to view the <a href=https://disqus.com/?ref_noscript>comments powered by Disqus.</a></noscript><a href=https://disqus.com class=dsq-brlink>comments powered by <span class=logo-disqus>Disqus</span></a></article></main><footer class=footer><span>&copy; 2024 <a href=https://alebsys.github.io/>Performance Matters</a></span>
<span>Powered by
<a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a> &
        <a href=https://github.com/adityatelange/hugo-PaperMod/ rel=noopener target=_blank>PaperMod</a></span></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentcolor"><path d="M12 6H0l6-6z"/></svg>
</a><script>let menu=document.getElementById("menu");menu&&(menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}),document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();var t=this.getAttribute("href").substr(1);window.matchMedia("(prefers-reduced-motion: reduce)").matches?document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView({behavior:"smooth"}),t==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${t}`)})})</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{document.body.className.includes("dark")?(document.body.classList.remove("dark"),localStorage.setItem("pref-theme","light")):(document.body.classList.add("dark"),localStorage.setItem("pref-theme","dark"))})</script><script>document.querySelectorAll("pre > code").forEach(e=>{const n=e.parentNode.parentNode,t=document.createElement("button");t.classList.add("copy-code"),t.innerHTML="copy";function s(){t.innerHTML="copied!",setTimeout(()=>{t.innerHTML="copy"},2e3)}t.addEventListener("click",t=>{if("clipboard"in navigator){navigator.clipboard.writeText(e.textContent),s();return}const n=document.createRange();n.selectNodeContents(e);const o=window.getSelection();o.removeAllRanges(),o.addRange(n);try{document.execCommand("copy"),s()}catch{}o.removeRange(n)}),n.classList.contains("highlight")?n.appendChild(t):n.parentNode.firstChild==n||(e.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName=="TABLE"?e.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(t):e.parentNode.appendChild(t))})</script></body></html>